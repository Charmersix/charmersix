<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="keywords" content="Hexo Theme Keep"><meta name="description" content="Hexo Theme Keep"><meta name="author" content="Charmersix"><title>Pwn_patch | Charmersix&#39;s Blog</title><link rel="stylesheet" href="/css/style.css"><link rel="shortcut icon" href="/images/logo.png"><link rel="stylesheet" href="//unpkg.com/hexo-theme-keep@3.6.1/source/font/css/fontawesome.min.css"><link rel="stylesheet" href="//unpkg.com/hexo-theme-keep@3.6.1/source/font/css/regular.min.css"><link rel="stylesheet" href="//unpkg.com/hexo-theme-keep@3.6.1/source/font/css/solid.min.css"><link rel="stylesheet" href="//unpkg.com/hexo-theme-keep@3.6.1/source/font/css/brands.min.css"><script id="hexo-configurations">let KEEP=window.KEEP||{};KEEP.hexo_config={hostname:"charmersix.github.io",root:"/",language:"en",path:"search.json"},KEEP.theme_config={toc:{enable:!0,number:!0,expand_all:!0,init_open:!0},style:{primary_color:"#0066cc",logo:"/images/logo.png",favicon:"/images/logo.png",avatar:"/images/head.jpg",font_size:null,font_family:null,hover:{shadow:!0,scale:!0},first_screen:{enable:!0,header_transparent:!0,background_img:"/images/bg.svg",description:"Keep writing and Keep loving.",font_color:null,hitokoto:!0},scroll:{progress_bar:!1,percent:!0}},local_search:{enable:!0,preload:!0},code_copy:{},code_block:{tools:{enable:!0,style:"mac"},highlight_theme:"obsidian"},side_tools:{},pjax:{enable:!1},lazyload:{enable:!1},comment:{enable:!0,use:"waline",valine:{appid:null,appkey:null,server_urls:null,placeholder:null},gitalk:{github_id:null,github_admins:null,repository:null,client_id:null,client_secret:null,proxy:null},twikoo:{env_id:null,region:null,version:"1.6.8"},waline:{server_url:"https://waline-charmersix.vercel.app/",reaction:!0,version:2}},post:{author_label:{enable:!1,auto:!1,custom_label_list:["CTFer"]},word_count:{enable:!0,wordcount:!0,min2read:!0},img_align:"left",copyright_info:!1},version:"3.6.1"},KEEP.language_ago={second:"%s seconds ago",minute:"%s minutes ago",hour:"%s hours ago",day:"%s days ago",week:"%s weeks ago",month:"%s months ago",year:"%s years ago"},KEEP.language_code_block={copy:"Copy code",copied:"Copied",fold:"Fold code block",folded:"Folded"},KEEP.language_copy_copyright={copy:"Copy copyright info",copied:"Copied",title:"Original article title",author:"Original article author",link:"Original article link"}</script><meta name="generator" content="Hexo 5.4.2"></head><body><div class="progress-bar-container"></div><main class="page-container"><div class="page-main-content"><div class="page-main-content-top"><header class="header-wrapper"><div class="header-content"><div class="left"><a class="logo-image" href="/"><img src="/images/logo.png"> </a><a class="logo-title" href="/">Charmersix&#39;s Blog</a></div><div class="right"><div class="pc"><ul class="menu-list"><li class="menu-item"><a href="/">HOME</a></li><li class="menu-item"><a href="/archives">ARCHIVES</a></li><li class="menu-item"><a href="/tags">TAGS</a></li><li class="menu-item"><a href="/links">LINKS</a></li><li class="menu-item"><a href="/about">ABOUT</a></li><li class="menu-item search search-popup-trigger"><i class="fas fa-search"></i></li></ul></div><div class="mobile"><div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div><div class="icon-item menu-bar"><div class="menu-bar-middle"></div></div></div></div></div><div class="header-drawer"><ul class="drawer-menu-list"><li class="drawer-menu-item flex-center"><a href="/">HOME</a></li><li class="drawer-menu-item flex-center"><a href="/archives">ARCHIVES</a></li><li class="drawer-menu-item flex-center"><a href="/tags">TAGS</a></li><li class="drawer-menu-item flex-center"><a href="/links">LINKS</a></li><li class="drawer-menu-item flex-center"><a href="/about">ABOUT</a></li></ul></div><div class="window-mask"></div></header></div><div class="page-main-content-middle"><div class="main-content"><div class="fade-in-down-animation"><div class="post-page-container"><div class="article-content-container"><div class="article-title"><span class="title-hover-animation">Pwn_patch</span></div><div class="article-header"><div class="avatar"><img src="/images/head.jpg"></div><div class="info"><div class="author"><span class="name">Charmersix</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fa-regular fa-calendar-plus"></i>&nbsp; <span class="pc">2023-05-30 21:49:29</span> <span class="mobile">2023-05-30 21:49</span> </span><span class="article-update-date article-meta-item"><i class="fas fa-file-pen"></i>&nbsp; <span class="pc">2023-06-21 19:23:44</span> </span><span class="article-tags article-meta-item"><i class="fas fa-tags"></i>&nbsp;<ul><li><a href="/tags/Study/">Study</a>&nbsp;</li><li>| <a href="/tags/Pwn/">Pwn</a>&nbsp;</li><li>| <a href="/tags/patch/">patch</a>&nbsp;</li><li>| <a href="/tags/awd/">awd</a>&nbsp;</li></ul></span><span class="article-wordcount article-meta-item"><i class="fas fa-file-word"></i>&nbsp;<span>1.2k Words</span> </span><span class="article-min2read article-meta-item"><i class="fas fa-clock"></i>&nbsp;<span>4 Mins</span> </span><span class="article-pv article-meta-item"><i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content keep-markdown-body"><p>此篇参考<code>合天网安实验室</code>的这篇<a class="link" target="_blank" rel="noopener" href="https://hetian.blog.csdn.net/article/details/119259414?spm=1001.2101.3001.6650.2&utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-2-119259414-blog-126009386.235%5Ev38%5Epc_relevant_sort_base1&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-2-119259414-blog-126009386.235%5Ev38%5Epc_relevant_sort_base1&utm_relevant_index=5">文章<i class="fas fa-external-link-alt"></i></a></p><h3 id="IDA安装keypatch插件"><a href="#IDA安装keypatch插件" class="headerlink" title="IDA安装keypatch插件"></a>IDA安装keypatch插件</h3><p>下载地址:<a class="link" target="_blank" rel="noopener" href="https://github.com/keystone-engine/keypatch">https://github.com/keystone-engine/keypatch<i class="fas fa-external-link-alt"></i></a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install keystone-engine</span><br><span class="line">pip install six</span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230611133831017.png" alt="image-20230611133831017"></p><p>将<code>keypatch.py</code>文件复制到 IDA的<code>plugins</code>文件夹下，重启IDA</p><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230611135751846.png" alt="image-20230611135751846"></p><p>安装成功</p><h3 id="跳转指令"><a href="#跳转指令" class="headerlink" title="跳转指令"></a>跳转指令</h3><h4 id="无符号跳转"><a href="#无符号跳转" class="headerlink" title="无符号跳转"></a>无符号跳转</h4><table><thead><tr><th align="left">汇编指令</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">JA</td><td align="left">无符号大于则跳转</td></tr><tr><td align="left">JNA</td><td align="left">无符号不大于则跳转</td></tr><tr><td align="left">JAE</td><td align="left">无符号大于等于则跳转（同JNB）</td></tr><tr><td align="left">JNAE</td><td align="left">无符号不大于等于则跳转（同JB）</td></tr><tr><td align="left">JB</td><td align="left">无符号小于则跳转</td></tr><tr><td align="left">JNB</td><td align="left">无符号不小于则跳转</td></tr><tr><td align="left">JBE</td><td align="left">无符号小于等于则跳转（同JNA）</td></tr><tr><td align="left">JBNE</td><td align="left">无符号不小于等于则跳转（同JA）</td></tr></tbody></table><h4 id="有符号跳转"><a href="#有符号跳转" class="headerlink" title="有符号跳转"></a>有符号跳转</h4><table><thead><tr><th align="left">汇编指令</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">JG</td><td align="left">有符号大于则跳转</td></tr><tr><td align="left">JNG</td><td align="left">有符号不大于则跳转</td></tr><tr><td align="left">JGE</td><td align="left">有符号大于等于则跳转（同JNL）</td></tr><tr><td align="left">JNGE</td><td align="left">有符号不大于等于则跳转（同JL）</td></tr><tr><td align="left">JL</td><td align="left">有符号小于则跳转</td></tr><tr><td align="left">JNL</td><td align="left">有符号不小于则跳转</td></tr><tr><td align="left">JLE</td><td align="left">有符号小于等于则跳转（同JNG）</td></tr><tr><td align="left">JNLE</td><td align="left">有符号不小于等于则跳转（同JG）</td></tr></tbody></table><h3 id="Patch-整数-溢出"><a href="#Patch-整数-溢出" class="headerlink" title="Patch-整数 溢出"></a>Patch-整数 溢出</h3><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/72b354a3eddbbdd846504f8848f5a0de.png" alt="img"></p><p><code>scanf</code>以<code>long int</code>长整形读取输入到<code>unsigned int</code>变量<code>v2</code>中, 然后将<code>v2</code>强制转化为<code>int</code>再与<code>int 48</code>比较</p><p>但从<code>scanf</code>读入一个负数时, 最高位为1, 从<code>unsigned int</code>强制转换为<code>int</code>结果是负数, 必定比48小, 在后面read读入会造成栈溢出</p><h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><p>将第九行的<code>if</code>跳转汇编指令<code>patch</code>为无符号的跳转指令, 具体参考跳转指令表</p><p>使用<code>keypatch</code>进行修改</p><p><code>jle--&gt;jbe</code></p><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/038a4867a090a6d0759e54222476d44f.png" alt="img"></p><h3 id="patch-栈溢出"><a href="#patch-栈溢出" class="headerlink" title="patch-栈溢出"></a>patch-栈溢出</h3><blockquote><p>对于栈溢出加固，x64 更容易一些，因为是使用寄存器传参，而x86 使用栈传参，需要用 nop 等保持加固前后的空间不变</p></blockquote><h4 id="x64"><a href="#x64" class="headerlink" title="x64"></a>x64</h4><p><img src="https://img-blog.csdnimg.cn/img_convert/98f9568c9e026e79f9dc936ea6473ed6.png"></p><h5 id="方法-1"><a href="#方法-1" class="headerlink" title="方法"></a>方法</h5><p>100是第三个参数, 存储寄存器是<code>rdx</code>, 找到给<code>rdx</code>传参的汇编指令进行<code>patch</code></p><p>使用ida默认修改插件修改(Edit-Patch Program-Change word), 也可以使用<code>keypatch</code></p><blockquote><p>0x64 是长度</p><p>0xBA 是操作符</p></blockquote><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/19a88f4b8a8f5be47e259eebc4a0eeb0.png" alt="img"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x64-&gt;0x20</span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/2c94d1a694dd37e99a9077fdb71f2170.png" alt="img"></p><h4 id="x86"><a href="#x86" class="headerlink" title="x86"></a>x86</h4><h5 id="不需要对齐"><a href="#不需要对齐" class="headerlink" title="不需要对齐"></a>不需要对齐</h5><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/f883954240cdb01ab721e9b78503b873.png" alt="img"></p><p>找到压栈的指令, 修改压入的数值</p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/3ae6c72ff7b2b22be046f1d6a7094026.png" alt="img" style="zoom:50%"><ul><li>修改数值需要补上 <code>0x</code></li><li>这里修改前 size 为 2 ，修改后 size 也为 2 ，所以这题 patch 不需要用 nop 保持 size</li></ul><h5 id="需要对齐"><a href="#需要对齐" class="headerlink" title="需要对齐"></a>需要对齐</h5><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/7e368de0510a9795c83e997e78a7df0b.png" alt="img"></p><p>找到压栈的指令, 修改压入的数值</p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/684b9b11433bf8e73fcdad8ab9e825a8.png" alt="img" style="zoom:50%"><p>直接修改<code>0x20</code>后, size 长度不对齐, 会引起栈空间变化, 需要用<code>nop</code>进行对齐</p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/b89e52e5c9baebdb42169425a70e111d.png" alt="img" style="zoom:50%"><p>更方便快捷的方法是勾选<code>NOPs padding until next instruction boundary</code>进行自动填充</p><h3 id="patch-格式化字符串"><a href="#patch-格式化字符串" class="headerlink" title="patch-格式化字符串"></a>patch-格式化字符串</h3><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/0e6a799a456e7ac369c842dc440fe4b4.png" alt="img"></p><h4 id="修改函数"><a href="#修改函数" class="headerlink" title="修改函数"></a>修改函数</h4><p>将<code>printf</code>改为<code>puts</code>, 将<code>call</code>的地址改为<code>puts plt</code>地址:</p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/058af66ace04155793e7f053d2bfb336.png" alt="img" style="zoom:67%"><p>这个方法局限性在于: puts会在原字符串多加<code>\n</code>, 主办方<code>check</code>可能因此而不通过</p><p>修改<code>printf</code>参数</p><p>将<code>printf(format)</code>修改为`printf(“%s”,format)</p><p>修改<code>printf</code>前面的传参指令:</p><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/f0cbfcf4449bf1733b42014c8af4ca5d.png" alt="img"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mov edi, offset <span class="number">0x400c01</span>; </span><br><span class="line">mov esi,offset format;</span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/3664e08df5c8427b32d3605db43517c4.png" alt="img"></p><h3 id="patch-UAF"><a href="#patch-UAF" class="headerlink" title="patch-UAF"></a>patch-UAF</h3><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/01659492ea3605ae2d8b9b75c445ae7f.png" alt="img"></p><p>修改逻辑是劫持<code>call</code>指令跳转到<code>.eh_frame</code>段上写入的自定义汇编程序</p><p>先在<code>.eh_frame</code>段上写入代码, 首先是<code>call free</code>完成释放, 然后对<code>chunk_list</code>进行置零. 取<code>chunk_list</code>地址的汇编可以从<code>call free</code>前面抄过来</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">call <span class="number">0x900</span>;           #调用<span class="built_in">free</span>函数（plt地址）</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">mov     eax, [rbp<span class="number">-0xc</span>]; #取出下标值</span><br><span class="line">cdqe;</span><br><span class="line">lea     rdx, ds:<span class="number">0</span>[rax*<span class="number">8</span>];</span><br><span class="line">lea rax, qword ptr [heap];</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">mov r8,<span class="number">0</span>; #段地址不能直接赋予立即数</span><br><span class="line">mov [rdx+rax],r8;</span><br><span class="line">jmp <span class="number">0xD56</span>; #跳回原来的地址</span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/0cc5f6ab077980bd83edc7644380aa0a.png" alt="img"></p><h3 id="patch-if范围"><a href="#patch-if范围" class="headerlink" title="patch-if范围"></a>patch-if范围</h3><p>假设需要将图上第二个if放到if结构内, 修改跳转的地址即可:</p><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/cd4cd5b99eeffa1a2ba466177ace475e.png" alt="img"></p><p>原始跳转代码:</p><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/4cf16ee0831a2c018ffdf9fd78d16366.png" alt="img"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">js <span class="number">0x40081C</span> --&gt; js <span class="number">0x400845</span></span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/4223a093cf4a64ed2476a0a2c0a2df8d.png" alt="img"></p><p>patch-更换危险函数</p><p>类似与 uaf 一样写汇编实现功能调用，将危险函数替换为其他函数，如果程序中没有目标函数，就通过系统调用方式调用。</p><p>将 gets 替换为 read 输入</p><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/413afcb82a7c0e35578bbd23e089cd1e.png" alt="img"></p><p><code>.eh_frame</code>写入汇编，将 <code>rdi</code> 的写入地址移动到 <code>rsi</code> ，把其他寄存器也传参之后进行系统调用：</p><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/7baaa05fe80dbe5e7e31b74068614694.png" alt="img"></p><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/31ade2b4fcb13c020d1d5bd80e39ea13.png" alt="img"></p><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/960b436de8c382dda96446f79ebf0a5f.png" alt="img"></p><h3 id="pwn通防小工具"><a href="#pwn通防小工具" class="headerlink" title="pwn通防小工具"></a>pwn通防小工具</h3><p>注意: 这里由于编译方式不同的原因, 作者写的工具目前仅适配Ubuntu16;18;20</p><p>基于pwntools和seccomp-tools的awd pwn通防小工具, 原创<a class="link" target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-273437.htm">在这<i class="fas fa-external-link-alt"></i></a></p><p>GitHub地址: <a class="link" target="_blank" rel="noopener" href="https://github.com/TTY-flag/evilPatcher">https://github.com/TTY-flag/evilPatcher<i class="fas fa-external-link-alt"></i></a></p><h4 id="环境需要"><a href="#环境需要" class="headerlink" title="环境需要"></a>环境需要</h4><p>运行需要依赖seccomps-tools和pwntools</p><p>pwntools安装</p><p>这里要在python2下安装,因为工具是基于python2的</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install python2</span><br><span class="line">sudo apt install python2</span><br><span class="line">curl https://bootstrap.pypa.io/pip/2.7/get-pip.py --output get-pip.py</span><br><span class="line">sudo python2 get-pip.py</span><br><span class="line">sudo python2 -m pip install pwntools</span><br></pre></td></tr></table></figure><p>seccomps-tools安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo gem install seccomp-tools</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果在编译时失败，请尝试：</span></span><br><span class="line">sudo apt install gcc ruby-dev</span><br></pre></td></tr></table></figure><h4 id="test"><a href="#test" class="headerlink" title="test"></a>test</h4><p>结束后我们可以随便找一个pwn题试一下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python2 exp1.py</span><br><span class="line">cat flag.txt</span><br></pre></td></tr></table></figure><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230621190055118.png" alt="image-20230621190055118"></p><p>然后</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 evilPatcher.py pwn1 sandboxs/mini_sandbox.asm 1</span><br></pre></td></tr></table></figure><p>试一下通防脚本</p><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230621190247222.png" alt="image-20230621190247222"></p><p>生成后的<code>pwn1.patch</code>修改为<code>pwn1</code>, 再运行一下exp</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python2 exp1.py</span><br><span class="line">cat flag.txt</span><br></pre></td></tr></table></figure><p>成功!</p><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image-20230621190431656.png" alt="image-20230621190431656"></p></div><ul class="post-tags-box"><li class="tag-item"><a href="/tags/Study/">#Study</a>&nbsp;</li><li class="tag-item"><a href="/tags/Pwn/">#Pwn</a>&nbsp;</li><li class="tag-item"><a href="/tags/patch/">#patch</a>&nbsp;</li><li class="tag-item"><a href="/tags/awd/">#awd</a>&nbsp;</li></ul><div class="article-nav"><div class="article-prev"><a class="prev" rel="prev" href="/2023/05/30/Web_11_Node.js/"><span class="left arrow-icon flex-center"><i class="fas fa-chevron-left"></i> </span><span class="title flex-center"><span class="post-nav-title-item">Web_11_Node.js</span> <span class="post-nav-item">Prev posts</span></span></a></div><div class="article-next"><a class="next" rel="next" href="/2023/04/25/AWD/"><span class="title flex-center"><span class="post-nav-title-item">Web_番外篇_AWD芝士</span> <span class="post-nav-item">Next posts</span> </span><span class="right arrow-icon flex-center"><i class="fas fa-chevron-right"></i></span></a></div></div><div class="comment-container"><div class="comments-container"><div id="comments-anchor"></div><div class="comment-area-title"><i class="fas fa-comments"></i>&nbsp;Comments</div><div class="waline-comment-container"><link rel="stylesheet" href="//unpkg.com/@waline/client@v2/dist/waline.css"><link rel="stylesheet" href="//unpkg.com/@waline/client@v2/dist/waline-meta.css"><script src="//unpkg.com/@waline/client@v2/dist/waline.js"></script><div id="waline-comment"></div><script>function loadWaline(){Waline.init({el:"#waline-comment",serverURL:"https://waline-charmersix.vercel.app/",lang:"en",comment:".post-comments-count",reaction:!0})}window.addEventListener("DOMContentLoaded",loadWaline)</script></div></div></div></div><div class="toc-content-container"><div class="post-toc-wrap"><div class="post-toc"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#IDA%E5%AE%89%E8%A3%85keypatch%E6%8F%92%E4%BB%B6"><span class="nav-number">1.</span> <span class="nav-text">IDA安装keypatch插件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4"><span class="nav-number">2.</span> <span class="nav-text">跳转指令</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%97%A0%E7%AC%A6%E5%8F%B7%E8%B7%B3%E8%BD%AC"><span class="nav-number">2.1.</span> <span class="nav-text">无符号跳转</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%89%E7%AC%A6%E5%8F%B7%E8%B7%B3%E8%BD%AC"><span class="nav-number">2.2.</span> <span class="nav-text">有符号跳转</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Patch-%E6%95%B4%E6%95%B0-%E6%BA%A2%E5%87%BA"><span class="nav-number">3.</span> <span class="nav-text">Patch-整数 溢出</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E6%B3%95"><span class="nav-number">3.1.</span> <span class="nav-text">方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#patch-%E6%A0%88%E6%BA%A2%E5%87%BA"><span class="nav-number">4.</span> <span class="nav-text">patch-栈溢出</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#x64"><span class="nav-number">4.1.</span> <span class="nav-text">x64</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%96%B9%E6%B3%95-1"><span class="nav-number">4.1.1.</span> <span class="nav-text">方法</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#x86"><span class="nav-number">4.2.</span> <span class="nav-text">x86</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%8D%E9%9C%80%E8%A6%81%E5%AF%B9%E9%BD%90"><span class="nav-number">4.2.1.</span> <span class="nav-text">不需要对齐</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%9C%80%E8%A6%81%E5%AF%B9%E9%BD%90"><span class="nav-number">4.2.2.</span> <span class="nav-text">需要对齐</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#patch-%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">5.</span> <span class="nav-text">patch-格式化字符串</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E5%87%BD%E6%95%B0"><span class="nav-number">5.1.</span> <span class="nav-text">修改函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#patch-UAF"><span class="nav-number">6.</span> <span class="nav-text">patch-UAF</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#patch-if%E8%8C%83%E5%9B%B4"><span class="nav-number">7.</span> <span class="nav-text">patch-if范围</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pwn%E9%80%9A%E9%98%B2%E5%B0%8F%E5%B7%A5%E5%85%B7"><span class="nav-number">8.</span> <span class="nav-text">pwn通防小工具</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E9%9C%80%E8%A6%81"><span class="nav-number">8.1.</span> <span class="nav-text">环境需要</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#test"><span class="nav-number">8.2.</span> <span class="nav-text">test</span></a></li></ol></li></ol></div></div></div></div></div></div></div><div class="page-main-content-bottom"><footer class="footer"><div class="info-container"><div class="copyright-info info-item">&copy; <span>2022.04.28</span> - 2023 &nbsp;<i class="fas fa-heart icon-animate"></i> &nbsp;<a href="/">Charmersix</a></div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="website-count info-item">Visitor Count&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp; Totalview&nbsp;<span id="busuanzi_value_site_pv"></span></div><div class="theme-info info-item">Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.6.1</a></div></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="tools-list"><li class="tools-item flex-center toggle-show-toc"><i class="fas fa-list"></i></li><li class="tools-item flex-center go-to-comments"><i class="fas fa-comment"></i> <span class="post-comments-count"></span></li></ul></div></div><div class="right-bottom-side-tools"><div class="side-tools-container"><ul class="side-tools-list"><li class="tools-item tool-font-adjust-plus flex-center"><i class="fas fa-search-plus"></i></li><li class="tools-item tool-font-adjust-minus flex-center"><i class="fas fa-search-minus"></i></li><li class="tools-item tool-dark-light-toggle flex-center"><i class="fas fa-moon"></i></li><li class="tools-item tool-scroll-to-bottom flex-center"><i class="fas fa-arrow-down"></i></li></ul><ul class="exposed-tools-list"><li class="tools-item tool-toggle-show flex-center"><i class="fas fa-cog fa-spin"></i></li><li class="tools-item tool-scroll-to-top flex-center"><i class="arrow-up fas fa-arrow-up"></i> <span class="percent"></span></li></ul></div></div><div class="zoom-in-image-mask"><img class="zoom-in-image"></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-input-field-pre"><i class="fas fa-keyboard"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="Search..." spellcheck="false" type="search" class="search-input"></div><span class="close-popup-btn"><i class="fas fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></main><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/utils.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/main.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/header-shrink.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/back2top.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/dark-light-toggle.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/local-search.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/code-block.js"></script><div class="post-scripts"><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/post-helper.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/libs/anime.min.js"></script><script src="//unpkg.com/hexo-theme-keep@3.6.1/source/js/toc.js"></script></div></body></html>